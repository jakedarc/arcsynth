/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t,e,n,i,r={501:()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){var t,i,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function l(e,r,a,o){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return n(s,"_invoke",function(e,n,r){var a,o,l,c=0,s=r||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,o=0,l=t,f.n=n,u}};function m(e,n){for(o=e,l=n,i=0;!d&&c&&!r&&i<s.length;i++){var r,a=s[i],m=f.p,v=a[2];e>3?(r=v===n)&&(l=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=t):a[0]<=m&&((r=e<2&&m<a[1])?(o=0,f.v=n,f.n=a[1]):m<v&&(r=e<3||a[0]>n||n>v)&&(a[4]=e,a[5]=n,f.n=v,o=0))}if(r||e>1)return u;throw d=!0,n}return function(r,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,v),o=s,l=v;(i=o<2?t:l)||!d;){a||(o?o<3?(o>1&&(f.n=-1),m(o,l)):f.n=l:f.v=l);try{if(c=2,a){if(o||(r="next"),i=a[r]){if(!(i=i.call(a,l)))throw TypeError("iterator result is not an object");if(!i.done)return i;l=i.value,o<2&&(o=0)}else 1===o&&(i=a.return)&&i.call(a),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);a=t}else if((i=(d=f.n<0)?l:e.call(n,f))!==u)break}catch(e){a=t,o=1,l=e}finally{c=1}}return{value:i,done:d}}}(e,a,o),!0),s}var u={};function c(){}function s(){}function d(){}i=Object.getPrototypeOf;var f=[][a]?i(i([][a]())):(n(i={},a,function(){return this}),i),m=d.prototype=c.prototype=Object.create(f);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,n(t,o,"GeneratorFunction")),t.prototype=Object.create(m),t}return s.prototype=d,n(m,"constructor",d),n(d,"constructor",s),s.displayName="GeneratorFunction",n(d,o,"GeneratorFunction"),n(m),n(m,o,"Generator"),n(m,a,function(){return this}),n(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:l,m:v}})()}function n(t,e,i,r){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}n=function(t,e,i,r){function o(e,i){n(t,e,function(t){return this._invoke(e,i,t)})}e?a?a(t,e,{value:i,enumerable:!r,configurable:!r,writable:!r}):t[e]=i:(o("next",0),o("throw",1),o("return",2))},n(t,e,i,r)}function i(t,e,n,i,r,a,o){try{var l=t[a](o),u=l.value}catch(t){return void n(t)}l.done?e(u):Promise.resolve(u).then(i,r)}function r(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=l(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function a(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a,o,l=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=a.call(n)).done)&&(l.push(i.value),l.length!==e);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return l}}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return u(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function s(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}var d=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.currentConfig=null,this.currentTab=null,this.partStates=new Map,this.multiValues=new Map,this.subsectionStates=new Map,this.helpMode=!1,this.currentTooltip=null,this.boundHandleControlMouseEnter=this.handleControlMouseEnter.bind(this),this.boundHandleControlMouseLeave=this.handleControlMouseLeave.bind(this)},n=[{key:"getCurrentPartKey",value:function(){return window.multiModeManager&&window.multiModeManager.isInMultiMode()?window.multiModeManager.currentPart:"single"}},{key:"controlValues",get:function(){var t=this.getCurrentPartKey();return this.partStates.has(t)||this.partStates.set(t,new Map),this.partStates.get(t)}},{key:"switchToPartState",value:function(){var t=this.currentTab;this.createTabs();var e=window.multiModeManager&&window.multiModeManager.isInMultiMode(),n=this.currentConfig.tabs.filter(function(t){return!t.multiOnly||e});t&&n.some(function(e){return e.id===t})?this.showTab(t):n.length>0&&this.showTab(n[0].id)}},{key:"clearAllPartStates",value:function(){this.partStates.clear()}},{key:"applyTheme",value:function(t){var e=document.documentElement;Object.entries({primaryColor:"--color-primary",primaryHover:"--color-primary-hover",buttonPrimary:"--color-button-primary",secondaryColor:"--color-secondary",secondaryHover:"--color-secondary-hover",successColor:"--color-success",successHover:"--color-success-hover",dangerColor:"--color-danger",warningColor:"--color-warning",warningHover:"--color-warning-hover",bgPrimary:"--bg-primary",bgSecondary:"--bg-secondary",bgTertiary:"--bg-tertiary",bgInput:"--bg-input",bgHover:"--bg-hover",bgDisabled:"--bg-disabled",borderColor:"--border-color",borderLight:"--border-color-light",textPrimary:"--text-primary",textSecondary:"--text-secondary",textMuted:"--text-muted",successBorder:"--notification-success-border",midiIncoming:"--midi-incoming"}).forEach(function(n){var i=o(n,2),r=i[0],a=i[1];t[r]&&e.style.setProperty(a,t[r])})}},{key:"loadConfig",value:function(t){this.currentConfig=t,this.clearAllPartStates(),this.savedPatchName=void 0,t.theme&&this.applyTheme(t.theme),this.createTabs(),t.tabs&&t.tabs.length>0&&this.showTab(t.tabs[0].id),t.midiChannel&&window.midiManager.setChannel(t.midiChannel);var e=document.getElementById("get-patch");e&&(e.style.display="block");var n=document.getElementById("reset-all-defaults");n&&(n.style.display="block");var i=document.getElementById("send-all-parameters");i&&(i.style.display="block"),window.multiModeManager&&window.multiModeManager.initialize(t)}},{key:"initializeAllControlValues",value:function(){var t,e,n=this;this.currentConfig&&this.currentConfig.tabs&&(this.currentConfig.tabs.forEach(function(t){t.sections&&t.sections.forEach(function(t){t.controls&&Array.isArray(t.controls)&&t.controls.forEach(function(t){if(t.id&&!n.controlValues.has(t.id)){var e=n.calculateDefaultValue(t);n.controlValues.set(t.id,e)}}),t.subsections&&Array.isArray(t.subsections)&&t.subsections.forEach(function(t){t.controls&&Array.isArray(t.controls)&&t.controls.forEach(function(t){if(t.id&&!n.controlValues.has(t.id)){var e=n.calculateDefaultValue(t);n.controlValues.set(t.id,e)}})})})}),((null===(t=this.currentConfig)||void 0===t||null===(t=t.multi)||void 0===t?void 0:t.multiControls)||[]).forEach(function(t){if(t.id&&!n.multiValues.has(t.id)){var e=n.calculateDefaultValue(t);n.multiValues.set(t.id,e)}}),((null===(e=this.currentConfig)||void 0===e?void 0:e.singleControls)||[]).forEach(function(t){if(t.id&&!n.controlValues.has(t.id)){var e=n.calculateDefaultValue(t);n.controlValues.set(t.id,e)}}))}},{key:"createTabs",value:function(){var t=this,e=document.getElementById("tab-container");if(e.innerHTML="",this.currentConfig&&this.currentConfig.tabs){this.createNamesUI(e);var n=window.multiModeManager&&window.multiModeManager.isInMultiMode();this.currentConfig.tabs.forEach(function(i){if(!i.multiOnly||n){var r=document.createElement("button");r.className="tab",r.textContent=i.name,r.dataset.tabId=i.id,r.onclick=function(){return t.showTab(i.id)},e.appendChild(r)}})}}},{key:"createNamesUI",value:function(t){var e=document.createElement("div");e.className="names-section",e.id="names-section",this.updateNamesUI(e),t.appendChild(e)}},{key:"updateNamesUI",value:function(){var t,e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||document.getElementById("names-section");e&&(e.innerHTML="",(null===(t=window.multiModeManager)||void 0===t?void 0:t.isInMultiMode())?this.createMultiModeNamesUI(e):this.createSingleModeNamesUI(e))}},{key:"createSingleModeNamesUI",value:function(t){var e,n=this,i=this.controlValues.get("patchName")||(null===(e=this.currentConfig)||void 0===e||null===(e=e.patchName)||void 0===e?void 0:e.default)||"Init Patch",r=document.createElement("div");r.className="name-display";var a=document.createElement("span");a.textContent=i,a.className="name-text";var o=document.createElement("button");o.textContent="Edit",o.className="btn-secondary",o.className+=" name-edit-button",o.onclick=function(){return n.openNameEditDialog()},r.appendChild(a),r.appendChild(o),t.appendChild(r)}},{key:"createMultiModeNamesUI",value:function(t){var e,n,i=this,r=this.multiValues.get("__multi_name")||(null===(e=this.currentConfig)||void 0===e||null===(e=e.multi)||void 0===e||null===(e=e.multiName)||void 0===e?void 0:e.default)||"Init Multi",a=(null===(n=window.multiModeManager)||void 0===n?void 0:n.getAvailableParts())||[],o=document.createElement("div");o.className="multi-name-div";var l=document.createElement("span");l.textContent=r,l.className="multi-name-text";var u=document.createElement("button");u.textContent="Edit",u.className="btn-secondary",u.className+=" name-edit-button",u.onclick=function(){return i.openNameEditDialog()},o.appendChild(l),o.appendChild(u),t.appendChild(o);var c=document.createElement("div");c.className="part-names-div",a.forEach(function(t){var e,n=i.partStates.get(t),r=n&&n.get("patchName")||(null===(e=i.currentConfig)||void 0===e||null===(e=e.patchName)||void 0===e?void 0:e.default)||"Init Patch",a=document.createElement("div");a.className="part-div",a.textContent="Part ".concat(t,": ").concat(r),c.appendChild(a)}),t.appendChild(c)}},{key:"openNameEditDialog",value:function(){var t;(null===(t=window.multiModeManager)||void 0===t?void 0:t.isInMultiMode())?this.showMultiNameEditDialog():this.showSingleNameEditDialog()}},{key:"showSingleNameEditDialog",value:function(){var t,e,n=this,i=this.controlValues.get("patchName")||(null===(t=this.currentConfig)||void 0===t||null===(t=t.patchName)||void 0===t?void 0:t.default)||"Init Patch",r=(null===(e=this.currentConfig)||void 0===e?void 0:e.singleControls)||[],a="";r.forEach(function(t){var e,i=null!==(e=n.controlValues.get(t.id))&&void 0!==e?e:n.calculateDefaultValue(t);if("select"===t.type){var r="";t.options.forEach(function(e,n){var a=t.midiValues?t.midiValues[n]:n,o=a===i?"selected":"";r+='<option value="'.concat(a,'" ').concat(o,">").concat(e,"</option>")}),a+='\n                    <div class="control" style="margin-bottom: 15px;">\n                        <label class="control-label">'.concat(t.name,':</label>\n                        <select id="edit-single-').concat(t.id,'" class="control-input" style="width: 250px;">\n                            ').concat(r,"\n                        </select>\n                    </div>\n                ")}});var o='\n            <div id="name-edit-modal" class="modal compact-modal">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h2>Edit Patch Settings</h2>\n                        <button id="close-name-edit" class="close-modal">&times;</button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="name-edit-content">\n                            <div class="control" style="margin-bottom: 20px;">\n                                <label class="control-label">Patch Name:</label>\n                                <input type="text" id="edit-patch-name" value="'.concat(i,'" maxlength="16" class="control-input" style="width: 250px;">\n                            </div>\n                            ').concat(a,'\n                            <div class="channel-config-actions">\n                                <button id="cancel-name-edit" class="btn-secondary">Cancel</button>\n                                <button id="save-and-send-patch" class="btn-success">Save and Send Patch</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ');document.body.insertAdjacentHTML("beforeend",o),document.getElementById("edit-patch-name").focus(),document.getElementById("edit-patch-name").select(),document.getElementById("close-name-edit").onclick=function(){return n.closeNameEditDialog()},document.getElementById("cancel-name-edit").onclick=function(){return n.closeNameEditDialog()},document.getElementById("save-and-send-patch").onclick=function(){return n.saveSingleNameAndSend()},document.addEventListener("keydown",this.nameEditEscapeHandler=function(t){"Escape"===t.key&&n.closeNameEditDialog()})}},{key:"showMultiNameEditDialog",value:function(){var t,e,n,i=this,r=this.multiValues.get("__multi_name")||(null===(t=this.currentConfig)||void 0===t||null===(t=t.multi)||void 0===t||null===(t=t.multiName)||void 0===t?void 0:t.default)||"Init Multi",a=(null===(e=window.multiModeManager)||void 0===e?void 0:e.getAvailableParts())||[],o="";a.forEach(function(t){var e,n=i.partStates.get(t),r=n&&n.get("patchName")||(null===(e=i.currentConfig)||void 0===e||null===(e=e.patchName)||void 0===e?void 0:e.default)||"Init Patch";o+='\n                <div class="control" style="margin-bottom: 15px;">\n                    <label class="control-label">Part '.concat(t,' Name:</label>\n                    <input type="text" id="edit-part-').concat(t,'-name" value="').concat(r,'" maxlength="16" class="control-input" style="width: 250px;">\n                </div>\n            ')});var l=(null===(n=this.currentConfig)||void 0===n||null===(n=n.multi)||void 0===n?void 0:n.multiControls)||[],u="";l.forEach(function(t){var e,n=null!==(e=i.multiValues.get(t.id))&&void 0!==e?e:i.calculateDefaultValue(t);if("select"===t.type){var r="";t.options.forEach(function(e,i){var a=t.midiValues?t.midiValues[i]:i,o=a===n?"selected":"";r+='<option value="'.concat(a,'" ').concat(o,">").concat(e,"</option>")}),u+='\n                    <div class="control" style="margin-bottom: 15px;">\n                        <label class="control-label">'.concat(t.name,':</label>\n                        <select id="edit-multi-').concat(t.id,'" class="control-input" style="width: 250px;">\n                            ').concat(r,"\n                        </select>\n                    </div>\n                ")}});var c='\n            <div id="name-edit-modal" class="modal compact-modal">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h2>Edit Multi Settings</h2>\n                        <button id="close-name-edit" class="close-modal">&times;</button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="name-edit-content">\n                            <div class="control" style="margin-bottom: 20px;">\n                                <label class="control-label">Multi Name:</label>\n                                <input type="text" id="edit-multi-name" value="'.concat(r,'" maxlength="16" class="control-input" style="width: 250px;">\n                            </div>\n                            ').concat(u,"\n                            ").concat(o,'\n                            <div class="channel-config-actions">\n                                <button id="cancel-name-edit" class="btn-secondary">Cancel</button>\n                                <button id="save-and-send-multi" class="btn-success">Save and Send Multi</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ');document.body.insertAdjacentHTML("beforeend",c),document.getElementById("edit-multi-name").focus(),document.getElementById("edit-multi-name").select(),document.getElementById("close-name-edit").onclick=function(){return i.closeNameEditDialog()},document.getElementById("cancel-name-edit").onclick=function(){return i.closeNameEditDialog()},document.getElementById("save-and-send-multi").onclick=function(){return i.saveMultiNamesAndSend()},document.addEventListener("keydown",this.nameEditEscapeHandler=function(t){"Escape"===t.key&&i.closeNameEditDialog()})}},{key:"closeNameEditDialog",value:function(){var t=document.getElementById("name-edit-modal");t&&t.remove(),this.nameEditEscapeHandler&&(document.removeEventListener("keydown",this.nameEditEscapeHandler),this.nameEditEscapeHandler=null)}},{key:"saveSingleNameAndSend",value:function(){var t,e=this,n=document.getElementById("edit-patch-name").value.trim();n?(this.controlValues.set("patchName",n),((null===(t=this.currentConfig)||void 0===t?void 0:t.singleControls)||[]).forEach(function(t){var n=document.getElementById("edit-single-".concat(t.id));if(n){var i=parseInt(n.value);e.controlValues.set(t.id,i)}}),this.closeNameEditDialog(),this.updateNamesUI(),this.sendAllParameters()):window.synthEditor.notificationManager.warning("Patch name cannot be empty.")}},{key:"saveMultiNamesAndSend",value:function(){var t,e,n=this,i=document.getElementById("edit-multi-name").value.trim();i?(this.multiValues.set("__multi_name",i),((null===(t=this.currentConfig)||void 0===t||null===(t=t.multi)||void 0===t?void 0:t.multiControls)||[]).forEach(function(t){var e=document.getElementById("edit-multi-".concat(t.id));if(e){var i=parseInt(e.value);n.multiValues.set(t.id,i)}}),((null===(e=window.multiModeManager)||void 0===e?void 0:e.getAvailableParts())||[]).forEach(function(t){var e=document.getElementById("edit-part-".concat(t,"-name")).value.trim();e&&(n.partStates.has(t)||n.partStates.set(t,new Map),n.partStates.get(t).set("patchName",e))}),this.closeNameEditDialog(),this.updateNamesUI(),this.sendAllParameters()):window.synthEditor.notificationManager.warning("Multi name cannot be empty.")}},{key:"showTab",value:function(t){var e=this.currentConfig.tabs.find(function(e){return e.id===t});if(e){document.getElementById("editor-area").scrollTop=0,this.currentTab=t,document.querySelectorAll(".tab").forEach(function(t){return t.classList.remove("active")});var n=document.querySelector('button[data-tab-id="'.concat(t,'"]'));n&&n.classList.add("active"),this.renderTabContent(e)}}},{key:"renderTabContent",value:function(t){var e=this,n=document.getElementById("content-container");n.innerHTML="",t.sections&&(t.sections.forEach(function(t){var i=e.createSection(t);n.appendChild(i)}),this.helpMode&&this.addHelpEventListeners())}},{key:"createSection",value:function(t){var e=this,n=document.createElement("div");n.className="section";var i=document.createElement("h3");if(i.textContent=t.name,n.appendChild(i),t.controls){var r=document.createElement("div");r.className="table"===t.layout?"mod-matrix-grid":"controls-grid",t.controls.forEach(function(t){if(t.part&&window.multiModeManager){var n=window.multiModeManager.currentPart;if(t.part!==n)return}var i=e.createControl(t);r.appendChild(i)}),n.appendChild(r)}return t.subsections&&t.subsections.forEach(function(i){var r=e.createSubsection(i,t.id);n.appendChild(r)}),n}},{key:"createSubsection",value:function(t,e){var n,i=this,r=document.createElement("div");r.className="subsection";var a=t.id||"".concat(e,"_").concat(t.name.replace(/\s+/g,"_").toLowerCase()),o="".concat(this.currentTab.id,"_").concat(a),l=document.createElement("div");l.className="subsection-header";var u=document.createElement("span");u.className="subsection-toggle",u.textContent="▶";var c=document.createElement("h4");c.textContent=t.name,l.appendChild(u),l.appendChild(c),r.appendChild(l);var s=document.createElement("div");if(s.className="subsection-content collapsed",null!==(n=this.subsectionStates.get(o))&&void 0!==n&&n&&(s.classList.remove("collapsed"),s.classList.add("expanded"),u.classList.add("expanded")),t.controls){var d=document.createElement("div");d.className="controls-grid",t.controls.forEach(function(t){if(t.part&&window.multiModeManager){var e=window.multiModeManager.currentPart;if(t.part!==e)return}var n=i.createControl(t);d.appendChild(n)}),s.appendChild(d)}return r.appendChild(s),l.addEventListener("click",function(){s.classList.contains("expanded")?(s.classList.remove("expanded"),s.classList.add("collapsed"),u.classList.remove("expanded"),i.subsectionStates.set(o,!1)):(s.classList.remove("collapsed"),s.classList.add("expanded"),u.classList.add("expanded"),i.subsectionStates.set(o,!0))}),r}},{key:"getControlClass",value:function(t){return t.readonly&&"text"===t.type?"Slot"===t.value||"Source 1"===t.value||"Source 2"===t.value||"Destination"===t.value||"FX Destination"===t.value||"Depth"===t.value?"mod-matrix-header":"mod-matrix-slot-label":"control"}},{key:"createControl",value:function(t){var e=document.createElement("div");e.className=this.getControlClass(t);var n,i=this.getControlClass(t);if(!i.includes("header")&&!i.includes("slot-label")){var r=document.createElement("div");r.className="control-label",r.textContent=t.name,e.appendChild(r)}switch(t.type){case"knob":n=this.createKnob(t);break;case"slider":default:n=this.createSlider(t);break;case"select":n=this.createSelect(t);break;case"button":n=this.createButton(t);break;case"text":n=this.createTextInput(t);break;case"adsr_display":n=this.createADSRDisplay(t)}if(e.appendChild(n),t.unit){var a=document.createElement("div");a.className="control-unit",a.textContent=t.unit,e.appendChild(a)}return e}},{key:"createKnob",value:function(t){var e,n=this,i=document.createElement("div");i.className="flex-column-center-gap";var r=document.createElement("div");r.className="knob",r._controlConfig=t,t.midi&&"cc"===t.midi.type&&void 0!==t.midi.number?r.setAttribute("data-cc",t.midi.number):t.midi&&"cc_pair"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb?r.setAttribute("data-cc-pair","".concat(t.midi.msb,",").concat(t.midi.lsb)):t.midi&&"nrpn"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb&&r.setAttribute("data-nrpn","".concat(t.midi.msb,":").concat(t.midi.lsb));var a=null!==(e=this.controlValues.get(t.id))&&void 0!==e?e:this.calculateDefaultValue(t),o=(a-(t.min||0))/((t.max||127)-(t.min||0))*100/100*270-135;r.style.transform="rotate(".concat(o,"deg)"),this.controlValues.set(t.id,a);var l=document.createElement("input");l.type="number",l.className="control-input";var u=this.convertInternalToDisplay(t,a);l.value=u,l.min=t.displayMin||t.min||0,l.max=t.displayMax||t.max||127,l.step=t.displayStep||t.step||1;var c=!1,s=0,d=a;r.addEventListener("mousedown",function(t){c=!0,s=t.clientY,d=parseFloat(l.value),document.addEventListener("mousemove",f),document.addEventListener("mouseup",m),t.preventDefault()});var f=function(e){var i,a;if(c){var o,u=s-e.clientY,f=t.displayMin||t.min||0,m=t.displayMax||t.max||127,v=m-f,p=t.displayStep||t.step||1;o="cc_pair"===(null===(i=t.midi)||void 0===i?void 0:i.type)||p<1?v>200?v/150:Math.min(p,1):v/100;var h=Math.max(f,Math.min(m,d+u*o)),y=(null===(a=p.toString().split(".")[1])||void 0===a?void 0:a.length)||0;h=Math.round(h/p)*p,h=Number(h.toFixed(y));var g=n.convertDisplayToInternal(t,h);g!==n.controlValues.get(t.id)&&n.updateControlValue(t,g,r,l)}},m=function(){c=!1,document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",m)};return l.addEventListener("input",function(e){var i=parseFloat(e.target.value),a=t.displayMin||t.min||0,o=t.displayMax||t.max||127;if(!isNaN(i)&&i>=a&&i<=o){var u,c=t.displayStep||t.step||1,s=(null===(u=c.toString().split(".")[1])||void 0===u?void 0:u.length)||0;i=Math.round(i/c)*c,i=Number(i.toFixed(s));var d=n.convertDisplayToInternal(t,i);n.updateControlValue(t,d,r,l)}}),r.addEventListener("dblclick",function(){var e=n.calculateDefaultValue(t);n.updateControlValue(t,e,r,l)}),i.appendChild(r),i.appendChild(l),i}},{key:"createSlider",value:function(t){var e,n=this,i=document.createElement("div");i.className="flex-column-center-gap",i.className+=" select-container-full-width";var r=document.createElement("input");r.type="range",r.className="slider",r.min=t.min||0,r.max=t.max||127,r.step=t.step||1,r._controlConfig=t,t.midi&&"cc"===t.midi.type&&void 0!==t.midi.number?r.setAttribute("data-cc",t.midi.number):t.midi&&"cc_pair"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb?r.setAttribute("data-cc-pair","".concat(t.midi.msb,",").concat(t.midi.lsb)):t.midi&&"nrpn"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb&&r.setAttribute("data-nrpn","".concat(t.midi.msb,":").concat(t.midi.lsb));var a=null!==(e=this.controlValues.get(t.id))&&void 0!==e?e:this.calculateDefaultValue(t);r.value=a,this.controlValues.set(t.id,a);var o=document.createElement("input");return o.type="number",o.className="control-input",o.value=a,o.min=t.min||0,o.max=t.max||127,o.step=t.step||1,o.style.width="80px",o.classList.add("text-center"),r.addEventListener("input",function(e){var i=parseFloat(e.target.value);o.value=i,n.updateControlValue(t,i)}),o.addEventListener("input",function(e){var i=parseFloat(e.target.value);if(!isNaN(i)&&i>=(t.min||0)&&i<=(t.max||127)){var a,o=t.step||1,l=(null===(a=o.toString().split(".")[1])||void 0===a?void 0:a.length)||0;i=Math.round(i/o)*o,i=Number(i.toFixed(l)),r.value=i,n.updateControlValue(t,i)}}),r.addEventListener("dblclick",function(){var e=n.calculateDefaultValue(t);r.value=e,o.value=e,n.updateControlValue(t,e)}),i.appendChild(r),i.appendChild(o),i}},{key:"createSelectAsKnob",value:function(t){var e,n=this,i=document.createElement("div");i.className="flex-column-center-gap";var r=document.createElement("div");r.className="knob",r._controlConfig=t,t.midi&&"cc"===t.midi.type&&void 0!==t.midi.number?r.setAttribute("data-cc",t.midi.number):t.midi&&"cc_pair"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb?r.setAttribute("data-cc-pair","".concat(t.midi.msb,",").concat(t.midi.lsb)):t.midi&&"nrpn"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb&&r.setAttribute("data-nrpn","".concat(t.midi.msb,":").concat(t.midi.lsb));var o=[],l=[];if(t.options)o=a(t.options),l=t.midiValues?a(t.midiValues):t.options.map(function(t,e){return e});else for(var u=t.min||0,c=t.max||127,s=u;s<=c;s++)o.push(s.toString()),l.push(s);var d=null!==(e=this.controlValues.get(t.id))&&void 0!==e?e:this.calculateDefaultValue(t),f=l.indexOf(d),m=f/(o.length-1)*100/100*270-135;r.style.transform="rotate(".concat(m,"deg)"),this.controlValues.set(t.id,d);var v=document.createElement("div");v.className="control-input knob-text-display",v.classList.add("text-center"),v.className+=" select-text-display",v.textContent=o[f]||o[0];var p=!1,h=0,y=f;r.addEventListener("mousedown",function(e){p=!0,h=e.clientY,y=l.indexOf(n.controlValues.get(t.id)),document.addEventListener("mousemove",g),document.addEventListener("mouseup",w),e.preventDefault()});var g=function(e){if(p){var i=h-e.clientY,a=o.length/100,u=Math.max(0,Math.min(o.length-1,Math.round(y+i*a))),c=l[u],s=o[u];if(c!==n.controlValues.get(t.id)){var d=u/(o.length-1)*100/100*270-135;r.style.transform="rotate(".concat(d,"deg)"),v.textContent=s,n.updateControlValue(t,c)}}},w=function(){p=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",w)};return r.addEventListener("dblclick",function(){var e=n.calculateDefaultValue(t),i=l.indexOf(e),a=o[i],u=i/(o.length-1)*100/100*270-135;r.style.transform="rotate(".concat(u,"deg)"),v.textContent=a,n.updateControlValue(t,e)}),i.appendChild(r),i.appendChild(v),i}},{key:"createSelect",value:function(t){var e=this;if("knob"===t.display)return this.createSelectAsKnob(t);var n=document.createElement("div");n.className="select-container",n.className="select-container flex-column-center",n.className+=" select-container-with-gap";var i=document.createElement("button");i.className="select-arrow",i.textContent="◀",i.className+=" select-arrow";var r=document.createElement("select");r.className="control-input",r._controlConfig=t,t.midi&&"cc"===t.midi.type&&void 0!==t.midi.number?r.setAttribute("data-cc",t.midi.number):t.midi&&"cc_pair"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb?r.setAttribute("data-cc-pair","".concat(t.midi.msb,",").concat(t.midi.lsb)):t.midi&&"nrpn"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb&&r.setAttribute("data-nrpn","".concat(t.midi.msb,":").concat(t.midi.lsb));var o=document.createElement("button");o.className="select-arrow",o.textContent="▶",o.className+=" select-arrow";var l=[],u=[];if(t.options){var c;l=a(t.options),u=t.midiValues?a(t.midiValues):t.options.map(function(t,e){return e}),t.options.forEach(function(e,n){var i=document.createElement("option");i.value=t.midiValues?t.midiValues[n]:n,i.textContent=e,r.appendChild(i)});var s=this.calculateDefaultValue(t),d=null!==(c=this.controlValues.get(t.id))&&void 0!==c?c:s;r.value=d,this.controlValues.set(t.id,d)}else{for(var f,m=t.min||0,v=t.max||127,p=m;p<=v;p++){var h=document.createElement("option");h.value=p,h.textContent=p.toString(),r.appendChild(h),l.push(p.toString()),u.push(p)}var y=this.calculateDefaultValue(t),g=null!==(f=this.controlValues.get(t.id))&&void 0!==f?f:y;r.value=g,this.controlValues.set(t.id,g)}var w=function(){var t=u.indexOf(parseInt(r.value));i.disabled=t<=0,o.disabled=t>=u.length-1,i.disabled?i.classList.add("disabled"):i.classList.remove("disabled"),o.disabled?o.classList.add("disabled"):o.classList.remove("disabled")};i.addEventListener("click",function(n){if(n.preventDefault(),!i.disabled){var a=u.indexOf(parseInt(r.value));if(a>0){var o=u[a-1];r.value=o,e.updateControlValue(t,o),w()}}}),o.addEventListener("click",function(n){if(n.preventDefault(),!o.disabled){var i=u.indexOf(parseInt(r.value));if(i<u.length-1){var a=u[i+1];r.value=a,e.updateControlValue(t,a),w()}}}),r.addEventListener("change",function(n){e.updateControlValue(t,parseInt(n.target.value)),w()}),r.addEventListener("dblclick",function(){var n=e.calculateDefaultValue(t);r.value=n,e.updateControlValue(t,n),w()});var b=document.createElement("div");return b.className="button-row-flex",b.appendChild(i),b.appendChild(o),w(),n.appendChild(r),n.appendChild(b),n}},{key:"createButton",value:function(t){var e,n=this,i=document.createElement("button");i.textContent=t.name,i.className="control-input",i._controlConfig=t,t.midi&&"cc"===t.midi.type&&void 0!==t.midi.number?i.setAttribute("data-cc",t.midi.number):t.midi&&"cc_pair"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb?i.setAttribute("data-cc-pair","".concat(t.midi.msb,",").concat(t.midi.lsb)):t.midi&&"nrpn"===t.midi.type&&void 0!==t.midi.msb&&void 0!==t.midi.lsb&&i.setAttribute("data-nrpn","".concat(t.midi.msb,":").concat(t.midi.lsb));var r=null!==(e=this.controlValues.get(t.id))&&void 0!==e?e:this.getButtonDefaultValue(t);return this.controlValues.set(t.id,r),this.updateButtonAppearance(i,r,t),i.addEventListener("click",function(){if(n.isToggleButton(t)){var e,r=null!==(e=n.controlValues.get(t.id))&&void 0!==e?e:n.getButtonOffValue(t),a=n.isButtonOn(r,t)?n.getButtonOffValue(t):n.getButtonOnValue(t);n.controlValues.set(t.id,a),n.updateControlValue(t,a),n.updateButtonAppearance(i,a,t)}else{var o=t.value||127;n.updateControlValue(t,o)}}),i}},{key:"updateButtonAppearance",value:function(t,e,n){this.isToggleButton(n)&&(this.isButtonOn(e,n)?(t.classList.add("button-active-primary"),t.classList.remove("button-inactive-secondary")):(t.classList.add("button-inactive-secondary"),t.classList.remove("button-active-primary")))}},{key:"isToggleButton",value:function(t){return void 0!==t.onValue&&void 0!==t.offValue}},{key:"getButtonOnValue",value:function(t){return t.onValue}},{key:"getButtonOffValue",value:function(t){return t.offValue}},{key:"isButtonOn",value:function(t,e){return t===e.onValue}},{key:"getButtonDefaultValue",value:function(t){return"on"===t.default?t.onValue:"off"===t.default?t.offValue:void 0!==t.default?t.default:t.offValue}},{key:"createTextInput",value:function(t){var e=this;if(t.readonly){var n=document.createElement("div");return n.className="control-input",n.textContent=t.value||t.default||"",n.className="text-control-transparent",n}var i=document.createElement("input");i.type="text",i.className="control-input";var r=this.controlValues.get(t.id)||t.value||t.default||"";return i.value=r,"patch_name"===t.id&&(void 0===this.savedPatchName&&(this.savedPatchName=r),this.controlValues.has(t.id)||this.controlValues.set(t.id,r)),t.maxLength&&(i.maxLength=t.maxLength),i.addEventListener("input",function(n){e.updateControlValue(t,n.target.value)}),i._controlConfig=t,i}},{key:"createADSRDisplay",value:function(t){var e=document.createElement("div");e.className="adsr-display adsr-container";var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width","180"),n.setAttribute("height","80"),n.setAttribute("viewBox","0 0 180 80"),n.setAttribute("class","adsr-svg");var i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("stroke","var(--color-primary)"),i.setAttribute("stroke-width","2"),i.setAttribute("fill","none"),i.setAttribute("stroke-linejoin","round");var r=document.createElementNS("http://www.w3.org/2000/svg","g");r.setAttribute("stroke","var(--bg-secondary)"),r.setAttribute("stroke-width","1");for(var a=1;a<4;a++){var o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1","10"),o.setAttribute("y1",(20*a).toString()),o.setAttribute("x2","170"),o.setAttribute("y2",(20*a).toString()),r.appendChild(o)}for(var l=1;l<8;l++){var u=document.createElementNS("http://www.w3.org/2000/svg","line");u.setAttribute("x1",(10+20*l).toString()),u.setAttribute("y1","10"),u.setAttribute("x2",(10+20*l).toString()),u.setAttribute("y2","70"),r.appendChild(u)}return n.appendChild(r),n.appendChild(i),e.appendChild(n),e._adsrPath=i,e._config=t,this.updateADSRDisplay(e,t),e}},{key:"updateADSRDisplay",value:function(t,e){var n,i,r,a,o,l,u;if(t._adsrPath&&e.parameters){var c=e.parameters;if(c.attack&&c.decay&&c.sustain&&c.release){var s=c.delay&&null!==(n=this.controlValues.get(c.delay))&&void 0!==n?n:0,d=null!==(i=this.controlValues.get(c.attack))&&void 0!==i?i:0,f=c.hold&&null!==(r=this.controlValues.get(c.hold))&&void 0!==r?r:0,m=null!==(a=this.controlValues.get(c.decay))&&void 0!==a?a:75,v=null!==(o=this.controlValues.get(c.sustain))&&void 0!==o?o:35,p=null!==(l=this.controlValues.get(c.release))&&void 0!==l?l:45,h=c.loop&&null!==(u=this.controlValues.get(c.loop))&&void 0!==u?u:0,y=c.delay?s/127:0,g=Math.max(d/127,.05),w=c.hold?f/127:0,b=Math.max(m/127,.05),E=Math.max(p/127,.05),C=160/(y+g+w+b+.15+E),M=y*C,S=g*C,x=w*C,I=b*C,k=.15*C,P=E*C,N=10,D=70-v/127*50,T=["M ".concat(N,",70")];c.delay&&M>0&&(N+=M,T.push("L ".concat(N,",70"))),N+=S,T.push("L ".concat(N,",20")),c.hold&&x>0&&(N+=x,T.push("L ".concat(N,",20"))),N+=I,T.push("L ".concat(N,",").concat(D)),N+=k,T.push("L ".concat(N,",").concat(D)),N+=P,T.push("L ".concat(N,",70")),t._adsrPath.setAttribute("d",T.join(" ")),t._loopIcon||(t._loopIcon=document.createElementNS("http://www.w3.org/2000/svg","text"),t._loopIcon.setAttribute("x","160"),t._loopIcon.setAttribute("y","15"),t._loopIcon.setAttribute("fill","#4a90e2"),t._loopIcon.setAttribute("font-size","12"),t._loopIcon.setAttribute("font-family","monospace"),t._loopIcon.textContent="↻",t.querySelector("svg").appendChild(t._loopIcon)),t._loopIcon.style.display=h>0?"block":"none"}else window.logWarn("ADSR display requires attack, decay, sustain, and release parameters")}}},{key:"updateRelatedEnvelopeDisplays",value:function(t){var e=this;document.querySelectorAll(".adsr-display").forEach(function(n){var i;null!==(i=n._config)&&void 0!==i&&i.parameters&&Object.values(n._config.parameters).includes(t.id)&&e.updateADSRDisplay(n,n._config)})}},{key:"convertInternalToDisplay",value:function(t,e){if(void 0!==t.displayMin&&void 0!==t.displayMax){var n,i=(t.max||127)-(t.min||0),r=t.displayMax-t.displayMin,a=(e-(t.min||0))/i,o=t.displayMin+a*r,l=(null===(n=(t.displayStep||t.step||1).toString().split(".")[1])||void 0===n?void 0:n.length)||0;return Number(o.toFixed(l))}return e}},{key:"convertDisplayToInternal",value:function(t,e){if(void 0!==t.displayMin&&void 0!==t.displayMax){var n=t.displayMax-t.displayMin,i=(t.max||127)-(t.min||0),r=(e-t.displayMin)/n;return Math.round((t.min||0)+r*i)}return e}},{key:"convertControlValueToMidiValue",value:function(t,e){var n=e;if("button"===t.type)n=e;else if("select"===t.type&&Array.isArray(t.options))t.midiValues&&Array.isArray(t.midiValues),n=e;else if("number"==typeof e)if(t.midi&&void 0!==t.midi.min&&void 0!==t.midi.max){var i=t.min||0,r=(t.max||127)-i,a=t.midi.min,o=t.midi.max-a,l=(e-i)/r;n=Math.round(a+l*o)}else if("nrpn"===t.midi.type)n=Math.max(t.min||0,Math.min(t.max||127,Math.round(e)));else if("cc_pair"===t.midi.type)n=Math.max(0,Math.min(255,Math.round(e)));else{var u=(t.max||127)-(t.min||0);n=Math.round((e-(t.min||0))/u*127)}return n}},{key:"updateNonMidiElement",value:function(t,e,n){"INPUT"===t.tagName&&"text"===t.type||"SELECT"===t.tagName?t.value=n:"BUTTON"===t.tagName&&this.isToggleButton(e)&&(n===this.getButtonOnValue(e)?t.classList.add("btn-active"):t.classList.remove("btn-active"))}},{key:"getControlValue",value:function(t){return this.controlValues.get(t.id)}},{key:"updateControlValue",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this.controlValues.set(t.id,e),n&&i)if(i.classList.contains("knob-text-display")&&t.options){var o=a(t.options),l=(t.midiValues?a(t.midiValues):t.options.map(function(t,e){return e})).indexOf(e);if(l>=0){var u=l/(o.length-1)*100/100*270-135;n.style.transform="rotate(".concat(u,"deg)"),i.textContent=o[l]}}else{var c=(e-(t.min||0))/((t.max||127)-(t.min||0))*100/100*270-135;n.style.transform="rotate(".concat(c,"deg)");var s=this.convertInternalToDisplay(t,e);i.value=s}if(n||i||this.updateSingleUIElement(t),t.midi&&window.midiManager.isConnected&&!r){var d=this.convertControlValueToMidiValue(t,e);window.midiManager.sendMIDIMessage(t.midi,d)}this.updateRelatedEnvelopeDisplays(t)}},{key:"calculateDefaultValue",value:function(t){if("select"===t.type&&t.options){if(t.midiValues){var e=t.options.indexOf(t.default);return e>=0?t.midiValues[e]:t.midiValues[0]}var n=t.options.indexOf(t.default);return n>=0?n:0}return void 0!==t.default&&null!==t.default?t.default:null!==(i=t.min)&&void 0!==i?i:0;var i}},{key:"resetAllToDefaults",value:function(){this.currentConfig&&this.sendInitPatch()}},{key:"updateAllUIElements",value:function(){var t=this;this.currentTab&&this.currentTab.sections.forEach(function(e){e.controls&&e.controls.forEach(function(e){t.updateSingleUIElement(e)}),e.subsections&&e.subsections.forEach(function(e){e.controls&&e.controls.forEach(function(e){t.updateSingleUIElement(e)})})})}},{key:"updateSingleUIElement",value:function(t){var e,n,i,o=this,l=this.controlValues.get(t.id);if(void 0===l){var u=this.calculateDefaultValue(t);this.controlValues.set(t.id,u),l=u}var c="";if("cc"===(null===(e=t.midi)||void 0===e?void 0:e.type)&&void 0!==t.midi.number)c='[data-cc="'.concat(t.midi.number,'"]');else if("cc_pair"===(null===(n=t.midi)||void 0===n?void 0:n.type)&&void 0!==t.midi.msb&&void 0!==t.midi.lsb)c='[data-cc-pair="'.concat(t.midi.msb,",").concat(t.midi.lsb,'"]');else{if("nrpn"!==(null===(i=t.midi)||void 0===i?void 0:i.type)||void 0===t.midi.msb||void 0===t.midi.lsb){var s,d=r(document.querySelectorAll("input, select, button"));try{for(d.s();!(s=d.n()).done;){var f,m=s.value;if((null===(f=m._controlConfig)||void 0===f?void 0:f.id)===t.id)return void this.updateNonMidiElement(m,t,l)}}catch(t){d.e(t)}finally{d.f()}return}c='[data-nrpn="'.concat(t.midi.msb,":").concat(t.midi.lsb,'"]')}document.querySelectorAll(c).forEach(function(e){var n;if((null===(n=e._controlConfig)||void 0===n?void 0:n.id)===t.id)if("INPUT"===e.tagName&&"range"===e.type){e.value=l;var i=e.parentElement.querySelector('input[type="number"]');if(i){var r=o.convertInternalToDisplay(t,l);i.value=r}}else if("INPUT"===e.tagName&&"number"===e.type){var u=o.convertInternalToDisplay(t,l);e.value=u}else if(e.classList.contains("knob")){var c=e.parentElement.querySelector(".knob-text-display");if(c&&t.options){var s=a(t.options),d=(t.midiValues?a(t.midiValues):t.options.map(function(t,e){return e})).indexOf(l);if(d>=0){var f=d/(s.length-1)*100/100*270-135;e.style.transform="rotate(".concat(f,"deg)"),c.textContent=s[d]}}else{var m=(l-(t.min||0))/((t.max||127)-(t.min||0))*100/100*270-135;e.style.transform="rotate(".concat(m,"deg)");var v=e.parentElement.querySelector('input[type="number"]');if(v){var p=o.convertInternalToDisplay(t,l);v.value=p}}}else if("SELECT"===e.tagName){e.value=l;var h=e.closest(".select-container");if(h){var y=h.querySelector(".select-arrow:first-child"),g=h.querySelector(".select-arrow:last-child"),w=Array.from(e.options).map(function(t){return parseInt(t.value)}),b=w.indexOf(parseInt(l));y&&(y.disabled=b<=0,y.classList.toggle("disabled",y.disabled)),g&&(g.disabled=b>=w.length-1,g.classList.toggle("disabled",g.disabled))}}else"BUTTON"===e.tagName&&o.updateButtonAppearance(e,l,t)}),this.updateRelatedEnvelopeDisplays(t)}},{key:"getControlValueById",value:function(t){return this.controlValues.get(t)}},{key:"getAllControlValues",value:function(){this.ensureAllControlValuesInitialized();var t,e={},n=r(this.controlValues.entries());try{for(n.s();!(t=n.n()).done;){var i=o(t.value,2),a=i[0],l=i[1];this.isReadOnlyControl(a)||(e[a]=l)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"isReadOnlyControl",value:function(t){if(t.includes("_header_")||t.includes("_label")||t.includes("_display"))return!0;var e=this.findControlConfigById(t);return!(!e||"adsr_display"!==e.type&&!0!==e.readonly)}},{key:"findControlConfigById",value:function(t){if(!this.currentConfig||!this.currentConfig.tabs)return null;var e,n=r(this.currentConfig.tabs);try{for(n.s();!(e=n.n()).done;){var i,a=r(e.value.sections);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.controls&&Array.isArray(o.controls)){var l=o.controls.find(function(e){return e.id===t});if(l)return l}if(o.subsections&&Array.isArray(o.subsections)){var u,c=r(o.subsections);try{for(c.s();!(u=c.n()).done;){var s=u.value;if(s.controls&&Array.isArray(s.controls)){var d=s.controls.find(function(e){return e.id===t});if(d)return d}}}catch(t){c.e(t)}finally{c.f()}}}}catch(t){a.e(t)}finally{a.f()}}}catch(t){n.e(t)}finally{n.f()}return null}},{key:"ensureAllControlValuesInitialized",value:function(){var t=this;this.currentConfig&&this.currentConfig.tabs&&this.currentConfig.tabs.forEach(function(e){e.sections.forEach(function(e){e.controls&&Array.isArray(e.controls)&&e.controls.forEach(function(e){if(e.id&&!t.controlValues.has(e.id)){var n=t.calculateDefaultValue(e);t.controlValues.set(e.id,n)}}),e.subsections&&Array.isArray(e.subsections)&&e.subsections.forEach(function(e){e.controls&&Array.isArray(e.controls)&&e.controls.forEach(function(e){if(e.id&&!t.controlValues.has(e.id)){var n=t.calculateDefaultValue(e);t.controlValues.set(e.id,n)}})})})})}},{key:"loadControlValues",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var i=o(n[e],2),r=i[0],a=i[1];this.controlValues.set(r,a)}this.updateAllUIElements()}},{key:"sendAllParameters",value:(l=e().m(function t(){var n,i,a,l,u,c,s,d,f,m,v,p,h;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:if(window.midiManager.isConnected){t.n=1;break}return window.synthEditor.notificationManager.info("No MIDI device connected. Please connect a MIDI device first."),t.a(2);case 1:if(this.currentConfig&&this.currentConfig.tabs){t.n=2;break}return window.synthEditor.notificationManager.warning("No synthesizer configuration loaded."),t.a(2);case 2:if(!window.midiManager.inputDevice){t.n=6;break}return t.p=3,t.n=4,window.synthEditor.sysExHandler.getDumpAsBaseline();case 4:i=t.v,t.n=6;break;case 5:t.p=5,h=t.v,window.logWarn("Failed to get baseline from synthesizer, using generated dump:",h);case 6:if(i&&0!==i.trim().length){t.n=11;break}if(t.p=7,!((a=window.synthEditor.sysExHandler.generatePatchDump())&&a.length>0)){t.n=8;break}i=a.map(function(t){return t.toString(16).toUpperCase().padStart(2,"0")}).join(" "),window.logInfo("Using generated patch dump as baseline"),t.n=9;break;case 8:return window.synthEditor.notificationManager.error("Cannot generate patch dump - no template available"),t.a(2);case 9:t.n=11;break;case 10:return t.p=10,t.v,window.synthEditor.notificationManager.error("Failed to generate patch dump from current values"),t.a(2);case 11:return t.n=12,new Promise(function(t){return setTimeout(t,100)});case 12:if(l=null===(n=window.multiModeManager)||void 0===n?void 0:n.isInMultiMode(),u=new Map(this.controlValues),l){c=r(this.multiValues);try{for(c.s();!(s=c.n()).done;)d=o(s.value,2),f=d[0],m=d[1],u.set(f,m)}catch(t){c.e(t)}finally{c.f()}}if(v=window.synthEditor.sysExHandler.applyControlValuesToDump(i,u),!((p=v.trim().split(/\s+/).map(function(t){return parseInt(t,16)})).length<2||240!==p[0]||247!==p[p.length-1])){t.n=13;break}return window.synthEditor.notificationManager.error("Generated SysEx dump is malformed"),t.a(2);case 13:window.midiManager.sendSysEx(p)?window.synthEditor.notificationManager.success("".concat(l?"Multi":"Patch"," sent successfully!")):window.synthEditor.notificationManager.error("Failed to send ".concat(l?"multi":"patch"," to synthesizer"));case 14:return t.a(2)}},t,this,[[7,10],[3,5]])}),u=function(){var t=this,e=arguments;return new Promise(function(n,r){var a=l.apply(t,e);function o(t){i(a,n,r,o,u,"next",t)}function u(t){i(a,n,r,o,u,"throw",t)}o(void 0)})},function(){return u.apply(this,arguments)})},{key:"sendInitPatch",value:function(){var t,e,n;if(!window.midiManager.isConnected)return window.synthEditor.notificationManager.info("No MIDI device connected. Please connect a MIDI device first."),!1;var i,r=null===(t=window.multiModeManager)||void 0===t?void 0:t.isInMultiMode();if(r&&null!==(e=this.currentConfig)&&void 0!==e&&null!==(e=e.multi)&&void 0!==e&&e.initMulti)i=this.currentConfig.multi.initMulti;else{if(null===(n=this.currentConfig)||void 0===n||!n.initPatch)return window.synthEditor.notificationManager.warning(r?"No multi init patch available in configuration":"No init patch available in configuration"),!1;i=this.currentConfig.initPatch}try{if(window.midiManager.sendSysEx(i),window.synthEditor.notificationManager.success("Init sent to synthesizer!"),window.synthEditor.sysExHandler)try{var a,o=r&&(null===(a=this.currentConfig)||void 0===a||null===(a=a.multi)||void 0===a?void 0:a.initMulti)===i,l=window.synthEditor.sysExHandler.convertDumpToParameters(i,o);l&&Object.keys(l).length>0?(window.synthEditor.sysExHandler.convertedParameters=l,window.synthEditor.sysExHandler.applyConvertedValues()):window.synthEditor.notificationManager.warning("Init sent to synthesizer, but no parameters could be parsed from init SysEx")}catch(t){window.logError("Error parsing init SysEx:",t),window.synthEditor.notificationManager.warning("Init sent to synthesizer, but failed to parse init SysEx: "+t.message)}else window.synthEditor.notificationManager.warning("Init sent to synthesizer, but no SysEx handler available to update editor values");return!0}catch(t){return window.logError("Error sending init patch:",t),window.synthEditor.notificationManager.error("Failed to send init patch: "+t.message),!1}}},{key:"loadDefaultValues",value:function(){var t,e=this;if((null===(t=window.multiModeManager)||void 0===t?void 0:t.isInMultiMode())&&this.currentConfig.multi){var n=window.multiModeManager.getAvailableParts()||[];if(this.currentConfig.multi.multiName){var i=this.currentConfig.multi.multiName.default||"Init Multi";this.multiValues.set("__multi_name",i)}n.forEach(function(t){e.partStates.has(t)||e.partStates.set(t,new Map);var n=e.partStates.get(t);if(e.currentConfig.tabs.forEach(function(t){t.sections.forEach(function(t){t.controls&&t.controls.forEach(function(t){var i=e.calculateDefaultValue(t);n.set(t.id,i)}),t.subsections&&t.subsections.forEach(function(t){t.controls&&t.controls.forEach(function(t){var i=e.calculateDefaultValue(t);n.set(t.id,i)})})})}),e.currentConfig.patchName){var i=e.currentConfig.patchName.default||"Init Patch";n.set("patchName",i)}})}else{if(this.currentConfig.tabs.forEach(function(t){t.sections.forEach(function(t){t.controls&&t.controls.forEach(function(t){var n=e.calculateDefaultValue(t);e.controlValues.set(t.id,n)}),t.subsections&&t.subsections.forEach(function(t){t.controls&&t.controls.forEach(function(t){var n=e.calculateDefaultValue(t);e.controlValues.set(t.id,n)})})})}),this.currentConfig.patchName){var r=this.currentConfig.patchName.default||"Init Patch";this.controlValues.set("patchName",r)}(this.currentConfig.singleControls||[]).forEach(function(t){var n=e.calculateDefaultValue(t);e.controlValues.set(t.id,n)})}this.updateNamesUI(),this.updateAllUIElements()}},{key:"toggleHelpMode",value:function(){this.helpMode=!this.helpMode;var t=document.getElementById("help-mode-toggle");this.helpMode?(t.classList.add("help-active-button"),document.body.classList.add("help-cursor"),this.addHelpEventListeners()):(t.classList.remove("help-active-button"),document.body.classList.remove("help-cursor"),this.removeHelpEventListeners(),this.hideTooltip())}},{key:"addHelpEventListeners",value:function(){var t=this;document.querySelectorAll(".control").forEach(function(e){e.addEventListener("mouseenter",t.boundHandleControlMouseEnter),e.addEventListener("mouseleave",t.boundHandleControlMouseLeave)})}},{key:"removeHelpEventListeners",value:function(){var t=this;document.querySelectorAll(".control").forEach(function(e){e.removeEventListener("mouseenter",t.boundHandleControlMouseEnter),e.removeEventListener("mouseleave",t.boundHandleControlMouseLeave)})}},{key:"handleControlMouseEnter",value:function(t){if(this.helpMode){var e=t.target,n=this.findControlConfig(e);n&&this.showTooltip(t,n)}}},{key:"handleControlMouseLeave",value:function(t){this.helpMode&&this.hideTooltip()}},{key:"findControlConfig",value:function(t){var e=t.querySelector(".knob");if(e&&e._controlConfig)return e._controlConfig;var n=t.querySelector('input[type="range"]');if(n&&n._controlConfig)return n._controlConfig;var i=t.querySelector("select");if(i&&i._controlConfig)return i._controlConfig;var r=t.querySelector("button.control-input");if(r&&r._controlConfig)return r._controlConfig;var a=t.querySelector('input[type="text"]');if(a&&a._controlConfig)return a._controlConfig;var o=t.querySelector('input[type="number"]:not(.control-input)');if(o&&o._controlConfig)return o._controlConfig;var l=t.querySelector("[data-cc], [data-cc-pair], [data-nrpn]");return l&&l._controlConfig?l._controlConfig:null}},{key:"showTooltip",value:function(t,e){this.hideTooltip();var n=document.createElement("div");n.className="help-tooltip",n.className="control-tooltip";var i="<strong>".concat(e.name,"</strong><br>");e.midi&&("cc"===e.midi.type?i+="MIDI CC: ".concat(e.midi.number,"<br>"):"cc_pair"===e.midi.type?i+="MIDI CC Pair: MSB ".concat(e.midi.msb,", LSB ").concat(e.midi.lsb,"<br>"):"nrpn"===e.midi.type&&(i+="NRPN: MSB ".concat(e.midi.msb,", LSB ").concat(e.midi.lsb,"<br>")),void 0!==e.midi.min&&void 0!==e.midi.max&&(i+="MIDI Range: ".concat(e.midi.min,"-").concat(e.midi.max,"<br>")));var r="button"===e.type&&this.isToggleButton(e);if(void 0===e.min||void 0===e.max||r||(i+="Range: ".concat(e.min," to ").concat(e.max,"<br>")),r&&(i+="Off Value: ".concat(this.getButtonOffValue(e),"<br>"),i+="On Value: ".concat(this.getButtonOnValue(e),"<br>")),e.step&&!r&&(i+="Step: ".concat(e.step,"<br>")),void 0!==e.default&&(i+="Default: ".concat(e.default,"<br>")),e.options&&e.midiValues&&(i+="Options:<br>",e.options.forEach(function(t,n){var r=e.midiValues[n];i+="  ".concat(t," (").concat(r,")<br>")})),e.sysEx&&e.sysEx.offsets&&e.sysEx.offsets.length>0){var a,o,l=e.sysEx.offsets;if((null===(a=window.multiModeManager)||void 0===a?void 0:a.isInMultiMode())&&null!==(o=this.currentConfig)&&void 0!==o&&o.multi){var u,c=this.currentConfig.multi,s=c.multiSysexFirstPart||0,d=c.multiSysexPartOffset||0,f=null===(u=window.multiModeManager)||void 0===u?void 0:u.currentPart;if(f&&c.multiParts){var m=c.multiParts.indexOf(f);if(m>=0){var v=s+m*d;l=e.sysEx.offsets.map(function(t){return t+v})}}}i+="SysEx Offset(s): ".concat(l.join(" "),"<br>")}n.innerHTML=i,document.body.appendChild(n);var p=t.target.getBoundingClientRect(),h=n.getBoundingClientRect(),y=p.right+10,g=p.top;y+h.width>window.innerWidth&&(y=p.left-h.width-10),g+h.height>window.innerHeight&&(g=window.innerHeight-h.height-10),n.style.left=y+"px",n.style.top=g+"px",this.currentTooltip=n}},{key:"hideTooltip",value:function(){this.currentTooltip&&(this.currentTooltip.remove(),this.currentTooltip=null)}},{key:"findControlByIdInDOM",value:function(t){var e,n=r(document.querySelectorAll('input[type="text"]'));try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i._controlConfig&&i._controlConfig.id===t)return i.closest(".control")}}catch(t){n.e(t)}finally{n.f()}return null}}],n&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,l,u}();window.uiManager=new d},938:()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=n(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,u=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return l=t.done,t},e:function(t){u=!0,o=t},f:function(){try{l||null==i.return||i.return()}finally{if(u)throw o}}}}function n(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function r(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function l(n,i,r,o){var l=i&&i.prototype instanceof c?i:c,s=Object.create(l.prototype);return a(s,"_invoke",function(n,i,r){var a,o,l,c=0,s=r||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,o=0,l=t,f.n=n,u}};function m(n,i){for(o=n,l=i,e=0;!d&&c&&!r&&e<s.length;e++){var r,a=s[e],m=f.p,v=a[2];n>3?(r=v===i)&&(l=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=t):a[0]<=m&&((r=n<2&&m<a[1])?(o=0,f.v=i,f.n=a[1]):m<v&&(r=n<3||a[0]>i||i>v)&&(a[4]=n,a[5]=i,f.n=v,o=0))}if(r||n>1)return u;throw d=!0,i}return function(r,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,v),o=s,l=v;(e=o<2?t:l)||!d;){a||(o?o<3?(o>1&&(f.n=-1),m(o,l)):f.n=l:f.v=l);try{if(c=2,a){if(o||(r="next"),e=a[r]){if(!(e=e.call(a,l)))throw TypeError("iterator result is not an object");if(!e.done)return e;l=e.value,o<2&&(o=0)}else 1===o&&(e=a.return)&&e.call(a),o<2&&(l=TypeError("The iterator does not provide a '"+r+"' method"),o=1);a=t}else if((e=(d=f.n<0)?l:n.call(i,f))!==u)break}catch(e){a=t,o=1,l=e}finally{c=1}}return{value:e,done:d}}}(n,r,o),!0),s}var u={};function c(){}function s(){}function d(){}e=Object.getPrototypeOf;var f=[][i]?e(e([][i]())):(a(e={},i,function(){return this}),e),m=d.prototype=c.prototype=Object.create(f);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,a(t,o,"GeneratorFunction")),t.prototype=Object.create(m),t}return s.prototype=d,a(m,"constructor",d),a(d,"constructor",s),s.displayName="GeneratorFunction",a(d,o,"GeneratorFunction"),a(m),a(m,o,"Generator"),a(m,i,function(){return this}),a(m,"toString",function(){return"[object Generator]"}),(r=function(){return{w:l,m:v}})()}function a(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}a=function(t,e,n,i){function o(e,n){a(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(o("next",0),o("throw",1),o("return",2))},a(t,e,n,i)}function o(t,e,n,i,r,a,o){try{var l=t[a](o),u=l.value}catch(t){return void n(t)}l.done?e(u):Promise.resolve(u).then(i,r)}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,u(i.key),i)}}function u(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}var c=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.midiAccess=null,this.outputDevice=null,this.inputDevice=null,this.isConnected=!1,this.currentChannel=1,this.ccPairValues=new Map,this.nrpnState={msb:null,lsb:null}},i=[{key:"initialize",value:(a=r().m(function t(){var e;return r().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,!navigator.requestMIDIAccess){t.n=2;break}return t.n=1,navigator.requestMIDIAccess({sysex:!0});case 1:return this.midiAccess=t.v,t.a(2,!0);case 2:return window.window.logError("Web MIDI API not supported"),t.a(2,!1);case 3:t.n=5;break;case 4:return t.p=4,e=t.v,window.logError("Failed to enable WebMIDI:",e),t.a(2,!1);case 5:return t.a(2)}},t,this,[[0,4]])}),u=function(){var t=this,e=arguments;return new Promise(function(n,i){var r=a.apply(t,e);function l(t){o(r,n,i,l,u,"next",t)}function u(t){o(r,n,i,l,u,"throw",t)}l(void 0)})},function(){return u.apply(this,arguments)})},{key:"getAvailableOutputs",value:function(){if(!this.midiAccess)return[];var t,n=[],i=e(this.midiAccess.outputs.values());try{for(i.s();!(t=i.n()).done;){var r=t.value;n.push({id:r.id,name:r.name,manufacturer:r.manufacturer||"",version:r.version||"",stableId:this.createStableDeviceId(r)})}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"getAvailableInputs",value:function(){if(!this.midiAccess)return[];var t,n=[],i=e(this.midiAccess.inputs.values());try{for(i.s();!(t=i.n()).done;){var r=t.value;n.push({id:r.id,name:r.name,manufacturer:r.manufacturer||"",version:r.version||"",stableId:this.createStableDeviceId(r)})}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"createStableDeviceId",value:function(t){var e=t.manufacturer||"Unknown",n=t.name||"Unknown Device",i=t.type||"unknown",r=t.version||"",a="".concat(e,":").concat(n,":").concat(i);return r&&(a+=":".concat(r)),a}},{key:"findDeviceByStableId",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"output";if(!this.midiAccess)return null;var i,r=e(("output"===n?this.midiAccess.outputs:this.midiAccess.inputs).values());try{for(r.s();!(i=r.n()).done;){var a=i.value;if(this.createStableDeviceId(a)===t)return a}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"connectOutput",value:function(t){if(!this.midiAccess)return window.logError("MIDI access not initialized"),!1;try{var e=this.midiAccess.outputs.get(t);return e?(this.outputDevice=e,this.isConnected=!0,!0):(window.logError("Output device with ID ".concat(t," not found")),!1)}catch(t){return window.logError("Error connecting to output device:",t),!1}}},{key:"connectInput",value:function(t){var e=this;if(!this.midiAccess)return window.logError("MIDI access not initialized"),!1;try{var n=this.midiAccess.inputs.get(t);return n?(this.inputDevice=n,n.onmidimessage=function(t){e.handleMIDIInput(t)},!0):(window.logError("Input device with ID ".concat(t," not found")),!1)}catch(t){return window.logError("Error connecting to input device:",t),!1}}},{key:"disconnect",value:function(){this.inputDevice&&(this.inputDevice.onmidimessage=null),this.outputDevice=null,this.inputDevice=null,this.isConnected=!1}},{key:"setChannel",value:function(t){this.currentChannel=t}},{key:"sendCC",value:function(t,e){if(!this.outputDevice)return window.logWarn("No MIDI output device connected"),!1;try{var n=this.currentChannel-1+176,i=Math.max(0,Math.min(127,Math.round(e))),r=[n,t,i];return this.outputDevice.send(r),this.logMIDI("out","CC ".concat(t,": ").concat(i," (Ch ").concat(this.currentChannel,")"),r),!0}catch(t){return window.logError("Failed to send CC:",t),!1}}},{key:"sendCCPair",value:function(t,e,n){if(!this.outputDevice)return window.logWarn("No MIDI output device connected"),!1;try{var i=this.currentChannel-1+176,r=Math.max(0,Math.min(255,Math.round(n))),a=r>>1&127,o=(1&r)<<6,l=[i,t,a],u=[i,e,o];return this.outputDevice.send(l),this.outputDevice.send(u),this.logMIDI("out","CC pair ".concat(t,"/").concat(e,": ").concat(r," (MSB:").concat(a,", LSB:").concat(o,") (Ch ").concat(this.currentChannel,")"),[l,u]),!0}catch(t){return window.logError("Failed to send CC pair:",t),!1}}},{key:"sendNRPN",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this.outputDevice)return window.logWarn("No MIDI output device connected"),!1;try{var a=this.currentChannel-1+176,o=[a,99,t];this.outputDevice.send(o),this.logMIDI("out","NRPN MSB: ".concat(t),o);var l=[a,98,e];this.outputDevice.send(l),this.logMIDI("out","NRPN LSB: ".concat(e),l);var u=[a,6,n];if(this.outputDevice.send(u),this.logMIDI("out","Data MSB: ".concat(n),u),!r){var c=[a,38,i];this.outputDevice.send(c),this.logMIDI("out","Data LSB: ".concat(i),c)}var s=r?"".concat(n," (MSB only)"):"".concat(n,":").concat(i);return this.logMIDI("out","NRPN ".concat(t,":").concat(e," = ").concat(s," (Ch ").concat(this.currentChannel,")")),!0}catch(t){return window.logError("Failed to send NRPN:",t),!1}}},{key:"shouldSendNRPNLSB",value:function(){return!window.uiManager||!window.uiManager.currentConfig||!1!==window.uiManager.currentConfig.nrpnSendLSB}},{key:"sendProgramChange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.outputDevice)return window.logWarn("No MIDI output device connected"),!1;try{var n=e||this.currentChannel,i=[n-1+192,Math.max(0,Math.min(127,t))];return this.outputDevice.send(i),this.logMIDI("out","Program Change: ".concat(t," (Ch ").concat(n,")"),i),!0}catch(t){return window.logError("Failed to send Program Change:",t),!1}}},{key:"sendSysEx",value:function(t){if(!this.outputDevice)return window.logWarn("No MIDI output device connected"),!1;try{var e;if("string"==typeof t)e=t.split(" ").map(function(t){return parseInt(t,16)});else{if(!Array.isArray(t))return window.logError("Invalid SysEx data format"),!1;e=t}return this.outputDevice.send(e),this.logMIDI("out","SysEx: ".concat(t),e),!0}catch(t){return window.logError("Failed to send SysEx:",t),!1}}},{key:"sendMIDIMessage",value:function(t,e){switch(t.type){case"cc":return this.sendCC(t.number,e);case"cc_pair":return this.sendCCPair(t.msb,t.lsb,e);case"nrpn":var n=Math.max(0,Math.min(127,Math.round(e))),i=this.shouldSendNRPNLSB();return this.sendNRPN(t.msb,t.lsb,n,0,!i);case"sysex":return void 0!==t.offset?window.synthEditor&&window.synthEditor.sysExHandler?window.synthEditor.sysExHandler.modifyAndSendDump(t.offset,e):(window.logWarn("SysExHandler not available"),!1):(window.logWarn("No offset provided"),!1);default:return window.logWarn("Unknown MIDI message type:",t.type),!1}}},{key:"handleMIDIInput",value:function(t){var e=Array.from(t.data),n=e[0],i=1+(15&n),r="",a=!1;switch(240&n){case 128:r="Note Off: ".concat(e[1]," velocity ").concat(e[2]," (Ch ").concat(i,")");break;case 144:r="Note On: ".concat(e[1]," velocity ").concat(e[2]," (Ch ").concat(i,")");break;case 176:99===e[1]?(r="NRPN MSB: ".concat(e[2]," (Ch ").concat(i,")"),this.nrpnState.msb=e[2]):98===e[1]?(r="NRPN LSB: ".concat(e[2]," (Ch ").concat(i,")"),this.nrpnState.lsb=e[2]):6===e[1]?(r="Data Entry MSB: ".concat(e[2]," (Ch ").concat(i,")"),null!==this.nrpnState.msb&&null!==this.nrpnState.lsb&&this.updateUIFromNRPN(this.nrpnState.msb,this.nrpnState.lsb,e[2],i)):38===e[1]?(r="Data Entry LSB: ".concat(e[2]," (Ch ").concat(i,")"),null===this.nrpnState.msb&&null===this.nrpnState.lsb&&(a=!0)):(r="CC ".concat(e[1],": ").concat(e[2]," (Ch ").concat(i,")"),a=!0);break;case 192:r="Program Change: ".concat(e[1]," (Ch ").concat(i,")");break;case 224:var o=e[1]+(e[2]<<7);r="Pitch Bend: ".concat(o," (Ch ").concat(i,")");break;case 240:r=240===n?"SysEx: ".concat(e.map(function(t){return t.toString(16).padStart(2,"0")}).join(" ")):"System: ".concat(n.toString(16)," (").concat(e.slice(1).join(" "),")");break;default:r="Unknown: ".concat(e.join(" "))}this.logMIDI("in",r,e),a&&this.updateUIFromCC(e[1],e[2],i)}},{key:"updateUIFromCC",value:function(t,e,n){n!==this.currentChannel&&1!==n||(this.handleCCPairUpdate(t,e,n),document.querySelectorAll('[data-cc="'.concat(t,'"]')).forEach(function(t){if("INPUT"===t.tagName&&"range"===t.type){var n=parseFloat(t.min)||0,i=parseFloat(t.max)||127,r=n+e/127*(i-n);t.value=Math.round(r);var a=t.parentElement.querySelector('input[type="number"]');a&&(a.value=Math.round(r));var o=t._controlConfig;o&&window.uiManager&&window.uiManager.updateControlValue(o,Math.round(r),null,null,!0)}else if("INPUT"===t.tagName&&"number"===t.type){t.value=e;var l=t._controlConfig;l&&window.uiManager&&window.uiManager.updateControlValue(l,e,null,null,!0)}else if(t.classList.contains("knob")){var u=t._controlConfig;if(u){var c=u.min+e/127*(u.max-u.min),s=(c-u.min)/(u.max-u.min)*270-135;t.style.transform="rotate(".concat(s,"deg)");var d=t.parentElement.querySelector(".control-input");d&&(d.value=Math.round(c)),window.uiManager&&window.uiManager.updateControlValue(u,Math.round(c),null,null,!0)}}else if("SELECT"===t.tagName){t.value=e;var f=t._controlConfig;f&&window.uiManager&&window.uiManager.updateControlValue(f,parseInt(e),null,null,!0)}}))}},{key:"updateUIFromNRPN",value:function(t,e,n,i){if(i===this.currentChannel||1===i){var r='[data-nrpn="'.concat(t,":").concat(e,'"]');document.querySelectorAll(r).forEach(function(t){var e=t._controlConfig;if(e){var i=n;if(void 0!==e.midi.min&&void 0!==e.midi.max){var r=e.midi.min,a=e.midi.max-r,o=e.min||0,l=(e.max||127)-o,u=(n-r)/a;i=Math.round(o+u*l)}if("INPUT"===t.tagName&&"range"===t.type){t.value=i;var c=t.parentElement.querySelector('input[type="number"]');c&&(c.value=i)}else if("INPUT"===t.tagName&&"number"===t.type)t.value=i;else if(t.classList.contains("knob")){var s=e.min||0,d=(i-s)/((e.max||127)-s)*100/100*270-135;t.style.transform="rotate(".concat(d,"deg)");var f=t.parentElement.querySelector('input[type="number"]');f&&(f.value=i)}else"SELECT"===t.tagName&&(t.value=i);window.uiManager&&window.uiManager.updateControlValue(e,i,null,null,!0)}})}}},{key:"logMIDI",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=(new Date).toLocaleTimeString(),r=document.getElementById("midi-log"),a=document.getElementById("modal-midi-log"),o=document.getElementById("mapper-midi-log"),l=document.createElement("div");l.className="midi-message ".concat("out"===t?"outgoing":"incoming");var u='<span class="midi-timestamp">'.concat(i,"</span> ");if(u+='<span class="midi-direction">'.concat(t.toUpperCase(),":</span> "),u+='<span class="midi-data">'.concat(e,"</span>"),n&&Array.isArray(n)){var c=n.map(function(t){return t.toString(16).padStart(2,"0").toUpperCase()}).join(" ");u+='<br><span class="midi-raw">['.concat(c,"]</span>")}if(l.innerHTML=u,r){var s=l.cloneNode(!0);r.appendChild(s);var d=document.getElementById("midi-monitor-content");d&&!d.classList.contains("hidden")&&(d.scrollTop=d.scrollHeight);var f=r.children;f.length>100&&r.removeChild(f[0])}if(a){var m=l.cloneNode(!0);a.appendChild(m),a.scrollTop=a.scrollHeight;var v=a.children;v.length>100&&a.removeChild(v[0])}if(o){var p=l.cloneNode(!0);o.appendChild(p),o.scrollTop=o.scrollHeight;var h=o.children;h.length>100&&o.removeChild(h[0])}}},{key:"handleCCPairUpdate",value:function(t,e,i){var r=this;document.querySelectorAll("[data-cc-pair]").forEach(function(i){var a=i.getAttribute("data-cc-pair").split(",").map(function(t){return parseInt(t.trim())}),o=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a,o,l=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=a.call(n)).done)&&(l.push(i.value),l.length!==e);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return l}}(t,e)||n(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(a,2),l=o[0],u=o[1];if(t===l||t===u){var c="".concat(l,",").concat(u);r.ccPairValues.has(c)||r.ccPairValues.set(c,{msb:0,lsb:0});var s=r.ccPairValues.get(c);t===l?s.msb=e:t===u&&(s.lsb=e);var d=s.msb<<1|s.lsb>>6&1;r.updateUIElementFromCCPair(i,d)}})}},{key:"updateUIElementFromCCPair",value:function(t,e){var n=t._controlConfig;if(n){var i=e;if(void 0!==n.midi.min&&void 0!==n.midi.max){var r=n.midi.min,a=n.midi.max-r,o=n.min||0,l=(n.max||127)-o,u=(e-r)/a;i=Math.round(o+u*l)}if("INPUT"===t.tagName&&"range"===t.type){t.value=i;var c=t.parentElement.querySelector('input[type="number"]');c&&(c.value=i)}else if(t.classList.contains("knob")){var s=n.min||0,d=(i-s)/((n.max||255)-s)*100/100*270-135;t.style.transform="rotate(".concat(d,"deg)");var f=t.parentElement.querySelector('input[type="number"]');f&&(f.value=i)}window.uiManager&&window.uiManager.updateControlValue(n,i,null,null,!0)}}}],i&&l(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,i,a,u}();window.midiManager=new c}},a={};function o(t){var e=a[t];if(void 0!==e)return e.exports;var n=a[t]={exports:{}};return r[t](n,n.exports,o),n.exports}o.m=r,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var r=Object.create(null);o.r(r);var a={};t=t||[null,e({}),e([]),e(e)];for(var l=2&i&&n;("object"==typeof l||"function"==typeof l)&&!~t.indexOf(l);l=e(l))Object.getOwnPropertyNames(l).forEach(t=>a[t]=()=>n[t]);return a.default=()=>n,o.d(r,a),r},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce((e,n)=>(o.f[n](t,e),e),[])),o.u=t=>t+".bundle.js",o.miniCssF=t=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n={},i="arcsynth-editor:",o.l=(t,e,r,a)=>{if(n[t])n[t].push(e);else{var l,u;if(void 0!==r)for(var c=document.getElementsByTagName("script"),s=0;s<c.length;s++){var d=c[s];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==i+r){l=d;break}}l||(u=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,o.nc&&l.setAttribute("nonce",o.nc),l.setAttribute("data-webpack",i+r),l.src=t),n[t]=[e];var f=(e,i)=>{l.onerror=l.onload=null,clearTimeout(m);var r=n[t];if(delete n[t],l.parentNode&&l.parentNode.removeChild(l),r&&r.forEach(t=>t(i)),e)return e(i)},m=setTimeout(f.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=f.bind(null,l.onerror),l.onload=f.bind(null,l.onload),u&&document.head.appendChild(l)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={792:0};o.f.j=(e,n)=>{var i=o.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise((n,r)=>i=t[e]=[n,r]);n.push(i[2]=r);var a=o.p+o.u(e),l=new Error;o.l(a,n=>{if(o.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,i[1](l)}},"chunk-"+e,e)}};var e=(e,n)=>{var i,r,[a,l,u]=n,c=0;if(a.some(e=>0!==t[e])){for(i in l)o.o(l,i)&&(o.m[i]=l[i]);u&&u(o)}for(e&&e(n);c<a.length;c++)r=a[c],o.o(t,r)&&t[r]&&t[r][0](),t[r]=0},n=self.webpackChunkarcsynth_editor=self.webpackChunkarcsynth_editor||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{"use strict";var t="undefined"!=typeof window&&!window.require;const e={isWeb:t,isElectron:!t,defaultConfigPath:"configs/novation-summit.json",showLoadConfigButton:!t,showFileMenus:!t,autoLoadDefaultConfig:t};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}var i,r,a;function l(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,i,r,a){var l=i&&i.prototype instanceof c?i:c,s=Object.create(l.prototype);return u(s,"_invoke",function(n,i,r){var a,l,u,c=0,s=r||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,l=0,u=t,f.n=n,o}};function m(n,i){for(l=n,u=i,e=0;!d&&c&&!r&&e<s.length;e++){var r,a=s[e],m=f.p,v=a[2];n>3?(r=v===i)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=t):a[0]<=m&&((r=n<2&&m<a[1])?(l=0,f.v=i,f.n=a[1]):m<v&&(r=n<3||a[0]>i||i>v)&&(a[4]=n,a[5]=i,f.n=v,l=0))}if(r||n>1)return o;throw d=!0,i}return function(r,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,v),l=s,u=v;(e=l<2?t:u)||!d;){a||(l?l<3?(l>1&&(f.n=-1),m(l,u)):f.n=u:f.v=u);try{if(c=2,a){if(l||(r="next"),e=a[r]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,l<2&&(l=0)}else 1===l&&(e=a.return)&&e.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=t}else if((e=(d=f.n<0)?u:n.call(i,f))!==o)break}catch(e){a=t,l=1,u=e}finally{c=1}}return{value:e,done:d}}}(n,r,a),!0),s}var o={};function c(){}function s(){}function d(){}e=Object.getPrototypeOf;var f=[][i]?e(e([][i]())):(u(e={},i,function(){return this}),e),m=d.prototype=c.prototype=Object.create(f);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,r,"GeneratorFunction")),t.prototype=Object.create(m),t}return s.prototype=d,u(m,"constructor",d),u(d,"constructor",s),s.displayName="GeneratorFunction",u(d,r,"GeneratorFunction"),u(m),u(m,r,"Generator"),u(m,i,function(){return this}),u(m,"toString",function(){return"[object Generator]"}),(l=function(){return{w:a,m:v}})()}function u(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}u=function(t,e,n,i){function a(e,n){u(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},u(t,e,n,i)}function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function s(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}function d(t,e,n,i,r,a,o){try{var l=t[a](o),u=l.value}catch(t){return void n(t)}l.done?e(u):Promise.resolve(u).then(i,r)}function f(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var a=t.apply(e,n);function o(t){d(a,i,r,o,l,"next",t)}function l(t){d(a,i,r,o,l,"throw",t)}o(void 0)})}}var m="undefined"!=typeof window&&window.require,v="undefined"!=typeof process&&(null===(i=process.versions)||void 0===i?void 0:i.node);function p(){return h.apply(this,arguments)}function h(){return h=f(l().m(function t(){var e,n;return l().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!v||m){t.n=6;break}return t.p=1,t.n=2,o.e(603).then(o.t.bind(o,603,23));case 2:return e=t.v,t.n=3,o.e(247).then(o.t.bind(o,247,23));case 3:n=t.v,r=e,a=n,t.n=5;break;case 4:t.p=4,t.v;case 5:t.n=7;break;case 6:if(m)try{r=window.require("fs"),a=window.require("path")}catch(t){}case 7:return t.a(2)}},t,null,[[1,4]])})),h.apply(this,arguments)}const y=new(function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxLogSize=5242880,this.isMainProcess="undefined"==typeof window,this.initialized=!1,this.initialize()},e=[{key:"initialize",value:(i=f(l().m(function t(){return l().w(function(t){for(;;)switch(t.n){case 0:if(this.initialized){t.n=2;break}return t.n=1,p();case 1:a&&(this.logFilePath=a.join(process.cwd(),"arcsynth-editor.log")),this.initialized=!0;case 2:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})},{key:"formatMessage",value:function(t,e){var n=(new Date).toISOString();return"[".concat(n,"] ").concat(t.toUpperCase(),": ").concat(e)}},{key:"writeToFile",value:(n=f(l().m(function t(e){var n;return l().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.initialize();case 1:if(r&&this.logFilePath){t.n=2;break}return t.a(2);case 2:try{r.existsSync(this.logFilePath)&&r.statSync(this.logFilePath).size>this.maxLogSize&&(n=this.logFilePath.replace(".log","-".concat(Date.now(),".log")),r.renameSync(this.logFilePath,n)),r.appendFileSync(this.logFilePath,e+"\n","utf8")}catch(t){console.error("Failed to write to log file:",t.message)}case 3:return t.a(2)}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"error",value:function(t){var e=this.formatMessage("error",t);if(console.error(t),this.isMainProcess)this.writeToFile(e);else if(m)try{window.require("electron").ipcRenderer.invoke("log-error",e).catch(function(){})}catch(t){}}},{key:"warn",value:function(t){console.warn(t)}},{key:"info",value:function(t){console.log(t)}},{key:"debug",value:function(t){}}],e&&c(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i}());function g(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,i,r,a){var u=i&&i.prototype instanceof l?i:l,c=Object.create(u.prototype);return w(c,"_invoke",function(n,i,r){var a,l,u,c=0,s=r||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,l=0,u=t,f.n=n,o}};function m(n,i){for(l=n,u=i,e=0;!d&&c&&!r&&e<s.length;e++){var r,a=s[e],m=f.p,v=a[2];n>3?(r=v===i)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=t):a[0]<=m&&((r=n<2&&m<a[1])?(l=0,f.v=i,f.n=a[1]):m<v&&(r=n<3||a[0]>i||i>v)&&(a[4]=n,a[5]=i,f.n=v,l=0))}if(r||n>1)return o;throw d=!0,i}return function(r,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,v),l=s,u=v;(e=l<2?t:u)||!d;){a||(l?l<3?(l>1&&(f.n=-1),m(l,u)):f.n=u:f.v=u);try{if(c=2,a){if(l||(r="next"),e=a[r]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,l<2&&(l=0)}else 1===l&&(e=a.return)&&e.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=t}else if((e=(d=f.n<0)?u:n.call(i,f))!==o)break}catch(e){a=t,l=1,u=e}finally{c=1}}return{value:e,done:d}}}(n,r,a),!0),c}var o={};function l(){}function u(){}function c(){}e=Object.getPrototypeOf;var s=[][i]?e(e([][i]())):(w(e={},i,function(){return this}),e),d=c.prototype=l.prototype=Object.create(s);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,w(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=c,w(d,"constructor",c),w(c,"constructor",u),u.displayName="GeneratorFunction",w(c,r,"GeneratorFunction"),w(d),w(d,r,"Generator"),w(d,i,function(){return this}),w(d,"toString",function(){return"[object Generator]"}),(g=function(){return{w:a,m:f}})()}function w(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}w=function(t,e,n,i){function a(e,n){w(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},w(t,e,n,i)}function b(t,e,n,i,r,a,o){try{var l=t[a](o),u=l.value}catch(t){return void n(t)}l.done?e(u):Promise.resolve(u).then(i,r)}function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function C(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a,o,l=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=a.call(n)).done)&&(l.push(i.value),l.length!==e);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return l}}(t,e)||k(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function S(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach(function(e){x(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function x(t,e,n){return(e=D(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=k(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}function k(t,e){if(t){if("string"==typeof t)return P(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(t,e):void 0}}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function N(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,D(i.key),i)}}function D(t){var e=function(t){if("object"!=E(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==E(e)?e:e+""}o(938),o(501);var T=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.synthEditor=e,this.baselineSysEx=null,this.currentTestSysEx=null,this.parameterList=[],this.currentParameterIndex=0,this.mappingResults={},this.currentParameterResults=[],this.isAutoRunning=!1,this.autoRunTimeout=null,this.dumpMappingData=null,this.convertedParameters=null,this.sysexListener=null,this.dumpListener=null},e=[{key:"extractSysExMappingFromConfig",value:function(){var t=window.uiManager.currentConfig;if(!t)return{};var e,n={},i=I(t.tabs||[]);try{for(i.s();!(e=i.n()).done;){var r,a=I(e.value.sections||[]);try{for(a.s();!(r=a.n()).done;){var o=r.value;this.extractSysExFromSection(o,n)}}catch(t){a.e(t)}finally{a.f()}}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"extractSysExFromSection",value:function(t,e){var n,i=I(t.controls||[]);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.sysEx&&r.id&&(e[r.id]=r.sysEx)}}catch(t){i.e(t)}finally{i.f()}var a,o=I(t.subsections||[]);try{for(o.s();!(a=o.n()).done;){var l=a.value;this.extractSysExFromSection(l,e)}}catch(t){o.e(t)}finally{o.f()}}},{key:"checkDumpMappingAvailability",value:function(){var t;null!==(t=window.uiManager)&&void 0!==t&&t.currentConfig?(this.dumpMappingData=this.extractSysExMappingFromConfig(),this.dumpMappingData&&0!==Object.keys(this.dumpMappingData).length||(this.dumpMappingData=null)):this.dumpMappingData=null}},{key:"processDumpData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{this.convertedParameters=this.convertDumpToParameters(t,e)}catch(t){throw window.logError("Dump conversion error:",t),t}}},{key:"convertDumpToParameters",value:function(t){var e,n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.dumpMappingData)throw new Error("No mapping data available");var r=t.split(" "),a={},o=null===(e=window.uiManager)||void 0===e?void 0:e.currentConfig;if(i&&null!=o&&o.multi){var l,u,c=o.multi,s=c.multiSysexFirstPart||0,d=c.multiSysexPartOffset||0,f=c.multiParts||[];if(null!==(l=c.multiName)&&void 0!==l&&l.sysEx)try{var m=this.extractParameterValue(r,c.multiName.sysEx);if(null!==m){var v=this.convertRawToControlValue(m,c.multiName.sysEx,c.multiName);a.__multi_name={name:"Multi Name",rawValue:m,controlValue:v,mappingInfo:c.multiName.sysEx,paramConfig:c.multiName,isMultiParam:!0}}}catch(t){window.logWarn("Failed to extract multiName:",t)}if((c.multiControls||[]).forEach(function(t){if(t.sysEx)try{var e=n.extractParameterValue(r,t.sysEx);if(null!==e){var i=n.convertRawToControlValue(e,t.sysEx,t);a[t.id]={name:t.name,rawValue:e,controlValue:i,mappingInfo:t.sysEx,paramConfig:t,isMultiParam:!0}}}catch(e){window.logWarn("Failed to extract ".concat(t.id,":"),e)}}),null!==(u=o.patchName)&&void 0!==u&&u.sysEx){var p,h=I(f);try{var y=function(){var t=p.value,e=s+f.indexOf(t)*d,i=S(S({},o.patchName.sysEx),{},{offsets:o.patchName.sysEx.offsets.map(function(t){return t+e})});try{var l=n.extractParameterValue(r,i);if(null!==l){var u=n.convertRawToControlValue(l,o.patchName.sysEx,o.patchName);a["".concat(t,"_patchName")]={name:"".concat(t," Patch Name"),rawValue:l,controlValue:u,mappingInfo:o.patchName.sysEx,paramConfig:o.patchName,part:t,originalParamId:"patchName"}}}catch(e){window.logWarn("Failed to extract patchName for part ".concat(t,":"),e)}};for(h.s();!(p=h.n()).done;)y()}catch(t){h.e(t)}finally{h.f()}}var g,w=I(f);try{for(w.s();!(g=w.n()).done;)for(var b=g.value,E=s+f.indexOf(b)*d,M=0,x=Object.entries(this.dumpMappingData);M<x.length;M++){var k=C(x[M],2),P=k[0],N=k[1];try{var D=this.extractParameterValueForPart(r,N,E);if(null!==D){var T=this.findParameterInConfig(P),V=this.convertRawToControlValue(D,N,T),L="".concat(b,"_").concat(P);a[L]={name:"".concat(b," ").concat((null==T?void 0:T.name)||P),rawValue:D,controlValue:V,mappingInfo:N,paramConfig:T,part:b,originalParamId:P}}}catch(t){window.logWarn("Failed to extract parameter ".concat(P," for part ").concat(b,":"),t)}}}catch(t){w.e(t)}finally{w.f()}}else{var A;if(null!==(A=o.patchName)&&void 0!==A&&A.sysEx)try{var O=this.extractParameterValue(r,o.patchName.sysEx);if(null!==O){var B=this.convertRawToControlValue(O,o.patchName.sysEx,o.patchName);a.patchName={name:"Patch Name",rawValue:O,controlValue:B,mappingInfo:o.patchName.sysEx,paramConfig:o.patchName}}}catch(t){window.logWarn("Failed to extract patchName:",t)}(o.singleControls||[]).forEach(function(t){if(t.sysEx)try{var e=n.extractParameterValue(r,t.sysEx);if(null!==e){var i=n.convertRawToControlValue(e,t.sysEx,t);a[t.id]={name:t.name,rawValue:e,controlValue:i,mappingInfo:t.sysEx,paramConfig:t}}}catch(e){window.logWarn("Failed to extract singleControl ".concat(t.id,":"),e)}});for(var j=0,F=Object.entries(this.dumpMappingData);j<F.length;j++){var _=C(F[j],2),q=_[0],U=_[1];try{if(!i){var H=this.findParameterInConfig(q);if(this.isParameterFromMultiOnlyTab(H,q))continue}var R=this.extractParameterValue(r,U);if(null!==R){var W=this.findParameterInConfig(q),z=this.convertRawToControlValue(R,U,W);a[q]={name:(null==W?void 0:W.name)||q,rawValue:R,controlValue:z,mappingInfo:U,paramConfig:W}}}catch(t){window.logWarn("Failed to extract parameter ".concat(q,":"),t)}}}return a}},{key:"extractParameterValueForPart",value:function(t,e,n){var i=S(S({},e),{},{offsets:e.offsets.map(function(t){return t+n})});return this.extractParameterValue(t,i)}},{key:"extractParameterValue",value:function(t,e){var n=e.type,i=e.offsets;if(!i||!Array.isArray(i)||0===i.length)return null;if("standard-7bit"===n||"select-7bit"===n||"toggle-7bit"===n||"range-7bit"===n){var r=i[0];if(r>=0&&r<t.length)return parseInt(t[r],16)}if("precision-7bit"===n&&i.length>=2){var a=i[0],o=i[1];if(a>=0&&a<t.length&&o>=0&&o<t.length)return{msb:parseInt(t[a],16),lsb:parseInt(t[o],16)}}if("text-16"===n&&i.length>=16){for(var l=[],u=0;u<16;u++){var c=i[u];if(!(c>=0&&c<t.length))return null;var s=parseInt(t[c],16);l.push(s)}return l}return null}},{key:"convertRawToControlValue",value:function(t,e,n){var i=null==n?void 0:n.type;if("select-7bit"===e.type){if("select"===i&&null!=n&&n.midiValues&&null!=n&&n.options){var r=n.midiValues,a=r.indexOf(t);return a>=0&&a<n.options.length?t:(window.logWarn("select-7bit: raw value ".concat(t," not found in midiValues for ").concat(n.id||"unknown")),r[0]||0)}return t}if("standard-7bit"===e.type){var o,l,u=null!==(o=null==n?void 0:n.min)&&void 0!==o?o:0,c=null!==(l=null==n?void 0:n.max)&&void 0!==l?l:127;return 0===u&&127===c?t:128==c-u+1?Math.round(t/127*(c-u)+u):t}if("toggle-7bit"===e.type)return"button"===i&&void 0!==(null==n?void 0:n.onValue)&&void 0!==(null==n?void 0:n.offValue)?t===n.onValue?1:(t===n.offValue||window.logWarn("toggle-7bit: raw value ".concat(t," doesn't match onValue (").concat(n.onValue,") or offValue (").concat(n.offValue,") for ").concat(n.id||"unknown")),0):127===t?1:0;if("range-7bit"===e.type){var s,d,f,m,v=null!==(s=null==n?void 0:n.min)&&void 0!==s?s:0,p=null!==(d=null==n?void 0:n.max)&&void 0!==d?d:127;if(void 0!==(null==n||null===(f=n.midi)||void 0===f?void 0:f.min)&&void 0!==(null==n||null===(m=n.midi)||void 0===m?void 0:m.max)){var h=n.midi.min,y=n.midi.max-h,g=p-v;if(0===y)return window.logWarn("range-7bit: MIDI range is zero for ".concat(n.id||"unknown")),v;var w=(t-h)/y*g+v;return Math.round(100*w)/100}return t}if("precision-7bit"===e.type){var b;if(t&&"object"===E(t)&&void 0!==t.msb&&void 0!==t.lsb){var C,M,S,x,I=t.msb,k=t.lsb,P=null!==(C=null==n?void 0:n.min)&&void 0!==C?C:0,N=null!==(M=null==n?void 0:n.max)&&void 0!==M?M:127,D=null==n||null===(S=n.midi)||void 0===S?void 0:S.min,T=null==n||null===(x=n.midi)||void 0===x?void 0:x.max;if(void 0!==D&&void 0!==T){var V,L=P+(2*I+(64===k?1:0)-D)/(T-D)*(N-P),A=Math.max(P,Math.min(N,L)),O=null!==(V=null==n?void 0:n.step)&&void 0!==V?V:1;if(O<1){var B=Math.max(0,-Math.floor(Math.log10(O)));return Number(A.toFixed(B))}return Math.round(A)}var j,F=null!==(j=null==n?void 0:n.step)&&void 0!==j?j:1,_=P+(2*I+(64===k?1:0))*F,q=Math.max(P,Math.min(N,_));if(F<1){var U=Math.max(0,-Math.floor(Math.log10(F)));return Number(q.toFixed(U))}return Math.round(q)}return null!==(b=null==n?void 0:n.min)&&void 0!==b?b:0}if("text-16"===e.type){if(Array.isArray(t)&&t.length>=16){for(var H="",R=0;R<16;R++){var W=t[R];H+=W>=32&&W<=126?String.fromCharCode(W):" "}return H.trimEnd()}return"Unknown"}return t}},{key:"generatePatchDump",value:function(){var t,e,n=window.uiManager.currentConfig;if(!n)throw new Error("No configuration loaded");var i,r=null===(t=window.multiModeManager)||void 0===t?void 0:t.isInMultiMode();if(r&&null!==(e=n.multi)&&void 0!==e&&e.initMulti)i=n.multi.initMulti;else{if(!n.initPatch)return window.logWarn("No patch template available for SysEx dump generation"),null;i=n.initPatch}var a=this.parseHexTemplate(i);return this.populateParameterValues(a,r),a}},{key:"parseHexTemplate",value:function(t){return t.trim().split(/\s+/).map(function(t){return parseInt(t,16)})}},{key:"populateParameterValues",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=window.uiManager.currentConfig;if(n&&i.multi)this.populateMultiPartValues(t,i);else{if(i.patchName){var r=window.uiManager.controlValues.get("patchName")||i.patchName.default||"Init Patch";try{this.writeValueToSysEx(r,i.patchName.sysEx.type,i.patchName.sysEx.offsets,i.patchName,t)}catch(t){window.logWarn("Failed to write patchName to SysEx:",t)}}(i.singleControls||[]).forEach(function(n){if(n.sysEx){var i,r=null!==(i=window.uiManager.controlValues.get(n.id))&&void 0!==i?i:window.uiManager.calculateDefaultValue(n);try{e.writeValueToSysEx(r,n.sysEx.type,n.sysEx.offsets,n,t)}catch(t){window.logWarn("Failed to write singleControl ".concat(n.id," to SysEx:"),t)}}});var a,o=I(i.tabs||[]);try{for(o.s();!(a=o.n()).done;){var l,u=I(a.value.sections||[]);try{for(u.s();!(l=u.n()).done;){var c=l.value;this.populateFromSection(c,t)}}catch(t){u.e(t)}finally{u.f()}}}catch(t){o.e(t)}finally{o.f()}}}},{key:"populateMultiPartValues",value:function(t,e){var n=this,i=e.multi,r=i.multiSysexFirstPart||0,a=i.multiSysexPartOffset||0,o=i.multiParts||[];if(i.multiName){var l=window.uiManager.multiValues.get("__multi_name")||i.multiName.default||"Init Multi";try{this.writeValueToSysEx(l,i.multiName.sysEx.type,i.multiName.sysEx.offsets,i.multiName,t)}catch(t){window.logWarn("Failed to write multiName to SysEx:",t)}}if(e.patchName){var u,c=I(o);try{var s=function(){var i,l=u.value,c=r+o.indexOf(l)*a,s=window.uiManager.partStates.get(l);i=s&&s.has("patchName")?s.get("patchName"):e.patchName.default||"Init Patch";var d=e.patchName.sysEx.offsets.map(function(t){return t+c});try{n.writeValueToSysEx(i,e.patchName.sysEx.type,d,e.patchName,t)}catch(t){window.logWarn("Failed to write patchName for part ".concat(l," to SysEx:"),t)}};for(c.s();!(u=c.n()).done;)s()}catch(t){c.e(t)}finally{c.f()}}var d,f=I(o);try{for(f.s();!(d=f.n()).done;){var m,v=d.value,p=r+o.indexOf(v)*a,h=window.uiManager.partStates.get(v),y=I(e.tabs||[]);try{for(y.s();!(m=y.n()).done;){var g,w=I(m.value.sections||[]);try{for(w.s();!(g=w.n()).done;){var b=g.value;this.populateFromSectionForPart(b,t,v,h,p)}}catch(t){w.e(t)}finally{w.f()}}}catch(t){y.e(t)}finally{y.f()}}}catch(t){f.e(t)}finally{f.f()}}},{key:"populateFromSectionForPart",value:function(t,e,n,i,r){if(t.controls){var a,o=I(t.controls);try{for(o.s();!(a=o.n()).done;){var l=a.value;l.sysEx&&this.populateControlValueForPart(l,e,n,i,r)}}catch(t){o.e(t)}finally{o.f()}}if(t.subsections){var u,c=I(t.subsections);try{for(c.s();!(u=c.n()).done;){var s=u.value;if(s.controls){var d,f=I(s.controls);try{for(f.s();!(d=f.n()).done;){var m=d.value;m.sysEx&&this.populateControlValueForPart(m,e,n,i,r)}}catch(t){f.e(t)}finally{f.f()}}}}catch(t){c.e(t)}finally{c.f()}}}},{key:"populateControlValueForPart",value:function(t,e,n,i,r){var a,o,l;a=i&&i.has(t.id)?i.get(t.id):null!==(o=null!==(l=window.uiManager.controlValues.get(t.id))&&void 0!==l?l:t.default)&&void 0!==o?o:0;var u=t.sysEx.offsets.map(function(t){return t+r});try{this.writeValueToSysEx(a,t.sysEx.type,u,t,e)}catch(e){window.logWarn("Failed to write ".concat(t.id," for part ").concat(n," to SysEx:"),e)}}},{key:"populateFromSection",value:function(t,e){var n=0;if(t.controls){var i,r=I(t.controls);try{for(r.s();!(i=r.n()).done;){var a=i.value;n++,a.sysEx&&this.populateControlValue(a,e)}}catch(t){r.e(t)}finally{r.f()}}if(t.subsections){var o,l=I(t.subsections);try{for(l.s();!(o=l.n()).done;){var u=o.value;if(u.controls){var c,s=I(u.controls);try{for(s.s();!(c=s.n()).done;){var d=c.value;n++,d.sysEx&&this.populateControlValue(d,e)}}catch(t){s.e(t)}finally{s.f()}}}}catch(t){l.e(t)}finally{l.f()}}return n}},{key:"populateControlValue",value:function(t,e){if(t.sysEx&&t.sysEx.offsets&&t.id){var n=window.uiManager.controlValues.get(t.id);if(void 0===n&&(n=t.default),void 0===n){if("select"===t.type&&t.options&&t.options.length>0)(null==(n=t.midiValues&&t.midiValues.length>0?t.midiValues[0]:0)||isNaN(n))&&(n=0);else if("button"===t.type)n=0;else{var i;n=null!==(i=t.min)&&void 0!==i?i:0}window.logWarn("No default value for control ".concat(t.id," (").concat(t.type,"), using fallback:"),n)}var r=t.sysEx.type,a=t.sysEx.offsets;try{this.writeValueToSysEx(n,r,a,t,e)}catch(e){window.logWarn("✗ Failed to write ".concat(t.id," to SysEx:"),e)}}}},{key:"writeValueToSysEx",value:function(t,e,n,i,r){switch(e){case"standard-7bit":case"select-7bit":case"toggle-7bit":case"range-7bit":if(n.length>0){var a=this.convertControlToRawValue(t,e,i);isNaN(a)?(window.logWarn("convertControlToRawValue returned NaN for ".concat(i.id,":"),t,e),r[n[0]]=0):r[n[0]]=Math.max(0,Math.min(127,a))}break;case"precision-7bit":if(n.length>=2){var o=this.convertControlToPrecisionBytes(t,i),l=o.msb,u=o.lsb;isNaN(l)||isNaN(u)?(window.logWarn("convertControlToPrecisionBytes returned NaN for ".concat(i.id,":"),t,{msb:l,lsb:u}),r[n[0]]=0,r[n[1]]=0):(r[n[0]]=l,r[n[1]]=u)}break;case"text-16":if(n.length>=16)for(var c=this.convertControlToTextBytes(t),s=0;s<16;s++)r[n[s]]=c[s];break;default:window.logWarn("Unknown SysEx type: ".concat(e))}}},{key:"convertControlToRawValue",value:function(t,e,n){if("select-7bit"===e){if("string"==typeof t&&n.options&&n.midiValues){var i=n.options.indexOf(t);return i>=0&&i<n.midiValues.length?n.midiValues[i]:(window.logWarn('Option "'.concat(t,'" not found in options array for ').concat(n.id)),NaN)}return t}var r,a,o,l;if("toggle-7bit"===e)return 1===t?null!==(r=n.onValue)&&void 0!==r?r:127:null!==(a=n.offValue)&&void 0!==a?a:0;if("range-7bit"===e&&void 0!==(null===(o=n.midi)||void 0===o?void 0:o.min)&&void 0!==(null===(l=n.midi)||void 0===l?void 0:l.max)){var u,c,s=null!==(u=n.min)&&void 0!==u?u:0,d=null!==(c=n.max)&&void 0!==c?c:127,f=n.midi.min,m=n.midi.max,v=(t-s)/(d-s);return Math.round(f+v*(m-f))}if("standard-7bit"===e){var p,h;if("string"==typeof t)return window.logWarn('standard-7bit got string value "'.concat(t,'" for ').concat(n.id," - this should be a number")),NaN;var y=null!==(p=null==n?void 0:n.min)&&void 0!==p?p:0,g=null!==(h=null==n?void 0:n.max)&&void 0!==h?h:127;return 0===y&&127===g?Math.round(t):128==g-y+1?Math.round((t-y)/(g-y)*127):Math.round(t)}return Math.round(t)}},{key:"convertControlToPrecisionBytes",value:function(t,e){var n,i,r,a,o,l=null!==(n=e.min)&&void 0!==n?n:0,u=null!==(i=e.max)&&void 0!==i?i:127,c=null==e||null===(r=e.midi)||void 0===r?void 0:r.min,s=null==e||null===(a=e.midi)||void 0===a?void 0:a.max;if(void 0!==c&&void 0!==s){var d=s-c,f=(t-l)/(u-l);o=Math.round(c+f*d)}else{var m,v=null!==(m=e.step)&&void 0!==m?m:1;o=Math.round((t-l)/v)}var p=Math.floor(o/2),h=o%2==1?64:0;return{msb:Math.max(0,Math.min(127,p)),lsb:h}}},{key:"convertControlToTextBytes",value:function(t){for(var e=String(t||"").substring(0,16),n=new Array(16).fill(32),i=0;i<e.length;i++){var r=e.charCodeAt(i);n[i]=r>=32&&r<=126?r:32}return n}},{key:"applyConvertedValuesToUI",value:function(){if(this.convertedParameters)if(window.uiManager&&window.uiManager.currentConfig){for(var t=0,e=0,n=0,i=Object.entries(this.convertedParameters);n<i.length;n++){var r,a=C(i[n],2),o=a[0],l=a[1];if("patchName"===o&&null!==(r=window.uiManager)&&void 0!==r&&null!==(r=r.currentConfig)&&void 0!==r&&r.patchName)window.uiManager.controlValues.set(o,l.controlValue),t++;else if(this.isFromSingleControls(o))window.uiManager.controlValues.set(o,l.controlValue),t++;else{var u=this.findControlConfig(o);u?(window.uiManager.controlValues.set(o,l.controlValue),window.uiManager.updateSingleUIElement(u),t++):e++}}t>0&&(window.logInfo("Applied ".concat(t," parameter values to editor controls.")),window.uiManager&&window.uiManager.updateNamesUI()),e>0&&window.logWarn("".concat(e," parameters not found in current configuration."))}else this.synthEditor.notificationManager.error("No synthesizer configuration loaded.");else this.synthEditor.notificationManager.warning("No converted parameters to apply.")}},{key:"applyConvertedValues",value:function(){var t;this.convertedParameters?window.uiManager&&window.uiManager.currentConfig?window.midiManager.isConnected?(null===(t=window.multiModeManager)||void 0===t?void 0:t.isInMultiMode())?this.applyConvertedValuesToAllParts():this.applyConvertedValuesToUI():this.synthEditor.notificationManager.info("No MIDI device connected. Please connect a MIDI device first."):this.synthEditor.notificationManager.error("No synthesizer configuration loaded."):this.synthEditor.notificationManager.warning("No converted parameters to apply.")}},{key:"applyConvertedValuesToAllParts",value:function(){if(this.convertedParameters){for(var t=window.multiModeManager,e=(null==t?void 0:t.getAvailableParts())||[],n=0,i=0,r=Object.entries(this.convertedParameters);i<r.length;i++){var a=C(r[i],2),o=a[0],l=a[1];if(l.isMultiParam)window.uiManager.multiValues.set(o,l.controlValue),n++;else if(l.part&&l.originalParamId){var u=l.part,c=l.originalParamId,s=l.controlValue;window.uiManager.partStates.has(u)||window.uiManager.partStates.set(u,new Map),window.uiManager.partStates.get(u).set(c,s),n++}else window.logWarn("Invalid parameter data structure for ".concat(o,":"),l)}window.logInfo("Applied ".concat(n," parameters to all ").concat(e.length," parts")),window.uiManager&&t&&(window.uiManager.switchToPartState(),window.uiManager.updateNamesUI())}else this.synthEditor.notificationManager.warning("No converted parameters to apply.")}},{key:"getDumpFromSynth",value:function(){var t,e,n,i,r,a=this;if(window.midiManager.isConnected)if(window.midiManager.inputDevice)if(null!==(t=window.uiManager)&&void 0!==t&&t.currentConfig){var o,l=window.uiManager.currentConfig,u=null===(e=window.multiModeManager)||void 0===e?void 0:e.isInMultiMode();if(u&&null!==(n=l.multi)&&void 0!==n&&n.multiDumpRequest)o=l.multi.multiDumpRequest,this.synthEditor.notificationManager.info("Requesting multi from synthesizer...");else{if(!l.patchDumpRequest)return void this.synthEditor.notificationManager.info(u?"This synthesizer configuration does not support multi requests.":"This synthesizer configuration does not support patch requests.");o=l.patchDumpRequest,this.synthEditor.notificationManager.info("Requesting patch from synthesizer...")}null!==(i=o)&&void 0!==i&&i.type&&null!==(r=o)&&void 0!==r&&r.data?this.requestPatchDump(o)?this.listenForSysEx(function(t){var e,n=u&&(null===(e=l.multi)||void 0===e?void 0:e.multiDumpRequest);a.processDumpData(t,n),a.convertedParameters&&Object.keys(a.convertedParameters).length>0&&a.applyConvertedValues(),a.synthEditor.notificationManager.success("Received ".concat(u?"multi":"patch"," from synthesizer!"))}):this.synthEditor.notificationManager.info("Failed to send request. Please check your MIDI connection.","error"):this.synthEditor.notificationManager.info("Invalid dump request configuration.")}else this.synthEditor.notificationManager.warning("No synthesizer configuration loaded.");else this.synthEditor.notificationManager.info("No MIDI input device connected.");else this.synthEditor.notificationManager.info("No MIDI device connected. Please connect a MIDI device first.")}},{key:"getDumpAsBaseline",value:(n=g().m(function t(){var e,n,i,r,a,o,l,u,c=this;return g().w(function(t){for(;;)switch(t.n){case 0:if(window.midiManager.isConnected){t.n=1;break}throw new Error("No MIDI device connected");case 1:if(null!==(e=window.uiManager)&&void 0!==e&&e.currentConfig){t.n=2;break}throw new Error("No synthesizer configuration loaded");case 2:if(o=window.uiManager.currentConfig,!(l=null===(n=window.multiModeManager)||void 0===n?void 0:n.isInMultiMode())||null===(i=o.multi)||void 0===i||!i.multiDumpRequest){t.n=3;break}u=o.multi.multiDumpRequest,t.n=5;break;case 3:if(!o.patchDumpRequest){t.n=4;break}u=o.patchDumpRequest,t.n=5;break;case 4:throw new Error(l?"This synthesizer configuration does not support multi dump requests.":"This synthesizer configuration does not support automatic patch dump requests.");case 5:if(null!==(r=u)&&void 0!==r&&r.type&&null!==(a=u)&&void 0!==a&&a.data){t.n=6;break}throw new Error("Invalid dump request configuration");case 6:if(this.requestPatchDump(u)){t.n=7;break}throw new Error("Failed to send patch dump request");case 7:return t.a(2,new Promise(function(t,e){var n=setTimeout(function(){c.stopListening(),e(new Error("Timeout waiting for patch dump"))},5e3);c.listenForSysEx(function(e){clearTimeout(n),t(e)})}))}},t,this)}),i=function(){var t=this,e=arguments;return new Promise(function(i,r){var a=n.apply(t,e);function o(t){b(a,i,r,o,l,"next",t)}function l(t){b(a,i,r,o,l,"throw",t)}o(void 0)})},function(){return i.apply(this,arguments)})},{key:"applyControlValuesToDump",value:function(t,e){var n,i;if(!t)throw new Error("No baseline dump provided");if(null===(n=window.uiManager)||void 0===n||!n.currentConfig)throw new Error("No synthesizer configuration loaded");var r=t.trim().split(/\s+/).map(function(t){return parseInt(t,16)}),a=window.uiManager.currentConfig;return(null===(i=window.multiModeManager)||void 0===i?void 0:i.isInMultiMode())&&a.multi?this.applyMultiPartValuesToDump(r,a,e):this.applySingleModeValuesToDump(r,a,e),r.map(function(t){return t.toString(16).toUpperCase().padStart(2,"0")}).join(" ")}},{key:"applySingleModeValuesToDump",value:function(t,e,n){var i=this;if(e.patchName){var r=n.get("patchName")||e.patchName.default||"Init Patch";try{this.writeValueToSysEx(r,e.patchName.sysEx.type,e.patchName.sysEx.offsets,e.patchName,t)}catch(t){window.logWarn("Failed to write patchName to SysEx:",t)}}(e.singleControls||[]).forEach(function(e){if(e.sysEx){var r,a=null!==(r=n.get(e.id))&&void 0!==r?r:window.uiManager.calculateDefaultValue(e);try{i.writeValueToSysEx(a,e.sysEx.type,e.sysEx.offsets,e,t)}catch(t){window.logWarn("Failed to write singleControl ".concat(e.id," to SysEx:"),t)}}});var a,o=I(e.tabs||[]);try{for(o.s();!(a=o.n()).done;){var l=a.value;if(!l.multiOnly){var u,c=I(l.sections||[]);try{for(c.s();!(u=c.n()).done;){var s=u.value;this.applySectionValuesToDump(s,t,n)}}catch(t){c.e(t)}finally{c.f()}}}}catch(t){o.e(t)}finally{o.f()}}},{key:"applyMultiPartValuesToDump",value:function(t,e,n){var i=this,r=e.multi,a=r.multiSysexFirstPart||0,o=r.multiSysexPartOffset||0,l=r.multiParts||[];if(r.multiName){var u=n.get("__multi_name")||r.multiName.default||"Init Multi";try{this.writeValueToSysEx(u,r.multiName.sysEx.type,r.multiName.sysEx.offsets,r.multiName,t)}catch(t){window.logWarn("Failed to write multiName to SysEx:",t)}}if((r.multiControls||[]).forEach(function(e){var r,a=null!==(r=n.get(e.id))&&void 0!==r?r:window.uiManager.calculateDefaultValue(e);try{i.writeValueToSysEx(a,e.sysEx.type,e.sysEx.offsets,e,t)}catch(t){window.logWarn("Failed to write ".concat(e.id," to SysEx:"),t)}}),e.patchName){var c,s=I(l);try{var d=function(){var n,r=c.value,u=a+l.indexOf(r)*o,s=window.uiManager.partStates.get(r);n=s&&s.has("patchName")?s.get("patchName"):e.patchName.default||"Init Patch";var d=e.patchName.sysEx.offsets.map(function(t){return t+u});try{i.writeValueToSysEx(n,e.patchName.sysEx.type,d,e.patchName,t)}catch(t){window.logWarn("Failed to write patchName for part ".concat(r," to SysEx:"),t)}};for(s.s();!(c=s.n()).done;)d()}catch(t){s.e(t)}finally{s.f()}}var f,m=I(l);try{for(m.s();!(f=m.n()).done;){var v,p=f.value,h=a+l.indexOf(p)*o,y=window.uiManager.partStates.get(p),g=I(e.tabs||[]);try{for(g.s();!(v=g.n()).done;){var w,b=I(v.value.sections||[]);try{for(b.s();!(w=b.n()).done;){var E=w.value;this.applySectionValuesForPartToDump(E,t,p,y,h)}}catch(t){b.e(t)}finally{b.f()}}}catch(t){g.e(t)}finally{g.f()}}}catch(t){m.e(t)}finally{m.f()}}},{key:"applySectionValuesToDump",value:function(t,e,n){if(t.controls){var i,r=I(t.controls);try{for(r.s();!(i=r.n()).done;){var a=i.value;a.sysEx&&this.applyControlValueToDump(a,e,n)}}catch(t){r.e(t)}finally{r.f()}}if(t.subsections){var o,l=I(t.subsections);try{for(l.s();!(o=l.n()).done;){var u=o.value;if(u.controls){var c,s=I(u.controls);try{for(s.s();!(c=s.n()).done;){var d=c.value;d.sysEx&&this.applyControlValueToDump(d,e,n)}}catch(t){s.e(t)}finally{s.f()}}}}catch(t){l.e(t)}finally{l.f()}}}},{key:"applySectionValuesForPartToDump",value:function(t,e,n,i,r){if(t.controls){var a,o=I(t.controls);try{for(o.s();!(a=o.n()).done;){var l=a.value;l.sysEx&&this.applyControlValueForPartToDump(l,e,n,i,r)}}catch(t){o.e(t)}finally{o.f()}}if(t.subsections){var u,c=I(t.subsections);try{for(c.s();!(u=c.n()).done;){var s=u.value;if(s.controls){var d,f=I(s.controls);try{for(f.s();!(d=f.n()).done;){var m=d.value;m.sysEx&&this.applyControlValueForPartToDump(m,e,n,i,r)}}catch(t){f.e(t)}finally{f.f()}}}}catch(t){c.e(t)}finally{c.f()}}}},{key:"applyControlValueToDump",value:function(t,e,n){if(t.sysEx&&t.sysEx.offsets&&t.id){var i=n.get(t.id);if(void 0===i&&(i=t.default),void 0===i){if("select"===t.type&&t.options&&t.options.length>0)(null==(i=t.midiValues&&t.midiValues.length>0?t.midiValues[0]:0)||isNaN(i))&&(i=0);else if("button"===t.type)i=0;else{var r;i=null!==(r=t.min)&&void 0!==r?r:0}window.logWarn("No default value for control ".concat(t.id," (").concat(t.type,"), using fallback:"),i)}try{this.writeValueToSysEx(i,t.sysEx.type,t.sysEx.offsets,t,e)}catch(e){window.logWarn("Failed to write ".concat(t.id," to SysEx:"),e)}}}},{key:"applyControlValueForPartToDump",value:function(t,e,n,i,r){var a,o;if(void 0===(a=i&&i.has(t.id)?i.get(t.id):null!==(o=window.uiManager.controlValues.get(t.id))&&void 0!==o?o:t.default)){if("select"===t.type&&t.options&&t.options.length>0)a=t.midiValues&&t.midiValues.length>0?t.midiValues[0]:0;else if("button"===t.type)a=0;else{var l;a=null!==(l=t.min)&&void 0!==l?l:0}window.logWarn("No default value for control ".concat(t.id," in part ").concat(n,", using fallback:"),a)}var u=t.sysEx.offsets.map(function(t){return t+r});try{this.writeValueToSysEx(a,t.sysEx.type,u,t,e)}catch(e){window.logWarn("Failed to write ".concat(t.id," for part ").concat(n," to SysEx:"),e)}}},{key:"findParameterInConfig",value:function(t){var e,n,i=I((null===(e=window.uiManager.currentConfig)||void 0===e?void 0:e.tabs)||[]);try{for(i.s();!(n=i.n()).done;){var r,a=I(n.value.sections||[]);try{for(a.s();!(r=a.n()).done;){var o=r.value,l=this.findParameterInSection(o,t);if(l)return l}}catch(t){a.e(t)}finally{a.f()}}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"findParameterInSection",value:function(t,e){var n,i=I(t.controls||[]);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.id===e)return r}}catch(t){i.e(t)}finally{i.f()}var a,o=I(t.subsections||[]);try{for(o.s();!(a=o.n()).done;){var l=a.value,u=this.findParameterInSection(l,e);if(u)return u}}catch(t){o.e(t)}finally{o.f()}return null}},{key:"isParameterFromMultiOnlyTab",value:function(t,e){var n,i,r=I((null===(n=window.uiManager.currentConfig)||void 0===n?void 0:n.tabs)||[]);try{for(r.s();!(i=r.n()).done;){var a,o=i.value,l=I(o.sections||[]);try{for(l.s();!(a=l.n()).done;){var u=a.value;if(this.sectionContainsParameter(u,e))return!0===o.multiOnly}}catch(t){l.e(t)}finally{l.f()}}}catch(t){r.e(t)}finally{r.f()}return!1}},{key:"sectionContainsParameter",value:function(t,e){var n,i=I(t.controls||[]);try{for(i.s();!(n=i.n()).done;)if(n.value.id===e)return!0}catch(t){i.e(t)}finally{i.f()}var r,a=I(t.subsections||[]);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(this.sectionContainsParameter(o,e))return!0}}catch(t){a.e(t)}finally{a.f()}return!1}},{key:"findControlConfig",value:function(t){var e,n,i=I((null===(e=window.uiManager.currentConfig)||void 0===e?void 0:e.tabs)||[]);try{for(i.s();!(n=i.n()).done;){var r,a=I(n.value.sections||[]);try{for(a.s();!(r=a.n()).done;){var o=r.value,l=this.findControlInSection(o,t);if(l)return l}}catch(t){a.e(t)}finally{a.f()}}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"findControlInSection",value:function(t,e){var n,i=I(t.controls||[]);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.id===e)return r}}catch(t){i.e(t)}finally{i.f()}var a,o=I(t.subsections||[]);try{for(o.s();!(a=o.n()).done;){var l=a.value,u=this.findControlInSection(l,e);if(u)return u}}catch(t){o.e(t)}finally{o.f()}return null}},{key:"requestPatchDump",value:function(){var t,e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||(null===(t=window.uiManager)||void 0===t||null===(t=t.currentConfig)||void 0===t?void 0:t.patchDumpRequest);if("sysex"===(null==e?void 0:e.type)&&window.midiManager.isConnected){var n=e.data.split(" ").map(function(t){return parseInt(t,16)});return window.midiManager.sendSysEx(n),!0}return!1}},{key:"listenForSysEx",value:function(t){var e=this;this.stopListening(),this.fragmentBuffer=[],this.fragmentTimeout=null,this.sysexListener=function(n){if(n.data){var i,r=Array.from(n.data),a=240===r[0],o=247===r[r.length-1];if(a&&o){var l=r.map(function(t){return t.toString(16).toUpperCase().padStart(2,"0")}).join(" ");return t(l),void e.stopListening()}(a||o)&&((i=e.fragmentBuffer).push.apply(i,r),e.fragmentTimeout&&clearTimeout(e.fragmentTimeout),e.fragmentTimeout=setTimeout(function(){if(e.fragmentBuffer.length>0&&240===e.fragmentBuffer[0]&&247===e.fragmentBuffer[e.fragmentBuffer.length-1]){var n=e.fragmentBuffer.map(function(t){return t.toString(16).toUpperCase().padStart(2,"0")}).join(" ");t(n),e.stopListening()}},50))}},window.midiManager.inputDevice&&window.midiManager.inputDevice.addEventListener("midimessage",this.sysexListener)}},{key:"stopListening",value:function(){window.midiManager.inputDevice&&this.sysexListener&&(window.midiManager.inputDevice.removeEventListener("midimessage",this.sysexListener),this.sysexListener=null),this.fragmentTimeout&&(clearTimeout(this.fragmentTimeout),this.fragmentTimeout=null),this.fragmentBuffer=[]}},{key:"modifyAndSendDump",value:function(t,e){try{var n=this.generatePatchDump();if(!n)return window.logError("Failed to generate patch dump for modification"),!1;if(!(t>=0&&t<n.length))return window.logError("SysEx offset ".concat(t," is out of range (0-").concat(n.length-1,")")),!1;n[t]=Math.max(0,Math.min(127,Math.round(e)));var i=Array.from(n).map(function(t){return t.toString(16).padStart(2,"0").toUpperCase()}).join(" ");if(window.midiManager&&window.midiManager.isConnected){var r=window.midiManager.sendSysEx(i);return r&&window.logInfo("SysEx dump sent with value ".concat(e," at offset ").concat(t)),r}return window.logWarn("MIDI not connected, cannot send SysEx dump"),!1}catch(t){return window.logError("Error in modifyAndSendDump:",t),!1}}},{key:"isFromSingleControls",value:function(t){var e,n=null===(e=window.uiManager)||void 0===e?void 0:e.currentConfig;return!(null==n||!n.singleControls)&&n.singleControls.some(function(e){return e.id===t})}}],e&&N(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i}();const V=T;function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function A(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,i,r,a){var u=i&&i.prototype instanceof l?i:l,c=Object.create(u.prototype);return O(c,"_invoke",function(n,i,r){var a,l,u,c=0,s=r||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,l=0,u=t,f.n=n,o}};function m(n,i){for(l=n,u=i,e=0;!d&&c&&!r&&e<s.length;e++){var r,a=s[e],m=f.p,v=a[2];n>3?(r=v===i)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=t):a[0]<=m&&((r=n<2&&m<a[1])?(l=0,f.v=i,f.n=a[1]):m<v&&(r=n<3||a[0]>i||i>v)&&(a[4]=n,a[5]=i,f.n=v,l=0))}if(r||n>1)return o;throw d=!0,i}return function(r,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,v),l=s,u=v;(e=l<2?t:u)||!d;){a||(l?l<3?(l>1&&(f.n=-1),m(l,u)):f.n=u:f.v=u);try{if(c=2,a){if(l||(r="next"),e=a[r]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,l<2&&(l=0)}else 1===l&&(e=a.return)&&e.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=t}else if((e=(d=f.n<0)?u:n.call(i,f))!==o)break}catch(e){a=t,l=1,u=e}finally{c=1}}return{value:e,done:d}}}(n,r,a),!0),c}var o={};function l(){}function u(){}function c(){}e=Object.getPrototypeOf;var s=[][i]?e(e([][i]())):(O(e={},i,function(){return this}),e),d=c.prototype=l.prototype=Object.create(s);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,O(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=c,O(d,"constructor",c),O(c,"constructor",u),u.displayName="GeneratorFunction",O(c,r,"GeneratorFunction"),O(d),O(d,r,"Generator"),O(d,i,function(){return this}),O(d,"toString",function(){return"[object Generator]"}),(A=function(){return{w:a,m:f}})()}function O(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}O=function(t,e,n,i){function a(e,n){O(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},O(t,e,n,i)}function B(t,e,n,i,r,a,o){try{var l=t[a](o),u=l.value}catch(t){return void n(t)}l.done?e(u):Promise.resolve(u).then(i,r)}function j(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var a=t.apply(e,n);function o(t){B(a,i,r,o,l,"next",t)}function l(t){B(a,i,r,o,l,"throw",t)}o(void 0)})}}function F(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_(i.key),i)}}function _(t){var e=function(t){if("object"!=L(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==L(e)?e:e+""}var q,U,H,R="undefined"!=typeof window&&window.require,W="undefined"!=typeof window&&!window.require;!function(){if(R)try{q=window.require("fs"),U=window.require("path");var t=window.require("electron");H=t.ipcRenderer}catch(t){window.logWarn("Node integration not available in Electron renderer")}}();var z=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.userConfigPath=U?U.join(process.cwd(),"user-config.json"):"user-config",this.userConfig=this.loadUserConfig()},e=[{key:"getConfigsPath",value:function(){return W?"configs":process.resourcesPath?U.join(process.resourcesPath,"configs"):U.join(process.cwd(),"configs")}},{key:"loadUserConfig",value:function(){try{if(q&&q.existsSync&&q.existsSync(this.userConfigPath))return JSON.parse(q.readFileSync(this.userConfigPath,"utf8"));if(W){var t=localStorage.getItem(this.userConfigPath);if(t)return JSON.parse(t)}}catch(t){window.logError("Error loading user config: "+t.message)}return{lastMidiOutput:null,lastMidiInput:null,lastConfigFile:null,lastPatchFolder:null,midiChannel:1}}},{key:"saveUserConfig",value:function(){try{q&&q.writeFileSync?q.writeFileSync(this.userConfigPath,JSON.stringify(this.userConfig,null,2)):W&&localStorage.setItem(this.userConfigPath,JSON.stringify(this.userConfig))}catch(t){window.logError("Error saving user config: "+t.message)}}},{key:"saveUserSetting",value:function(t,e){this.userConfig[t]=e,this.saveUserConfig()}},{key:"loadConfigFile",value:(r=j(A().m(function t(){var e,n,i,r,a,o;return A().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!W){t.n=1;break}return t.a(2,this.loadConfigFileBrowser());case 1:t.p=1,e={title:"Load Synthesizer Configuration",filters:[{name:"JSON Configs",extensions:["json"]}],properties:["openFile"]};try{this.userConfig.lastConfigFile&&"string"==typeof this.userConfig.lastConfigFile?(n=U.dirname(this.userConfig.lastConfigFile))&&"string"==typeof n&&q.existsSync(n)&&(e.defaultPath=n):(i=this.getConfigsPath())&&"string"==typeof i&&q.existsSync(i)&&(e.defaultPath=i)}catch(t){window.logError("Error setting default path for config dialog: "+t.message)}return t.n=2,H.invoke("show-open-dialog",e);case 2:if(!(r=t.v)){t.n=3;break}return a=JSON.parse(q.readFileSync(r,"utf8")),this.userConfig.lastConfigFile=r,this.saveUserConfig(),t.a(2,{config:a,filePath:r});case 3:return t.a(2,null);case 4:throw t.p=4,o=t.v,window.logError("Error in loadConfigFile: "+o.message+" | Stack: "+o.stack),new Error("Error loading configuration: "+o.message);case 5:return t.a(2)}},t,this,[[1,4]])})),function(){return r.apply(this,arguments)})},{key:"loadConfigFileBrowser",value:function(){var t=this;return new Promise(function(e){var n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=function(){var n=j(A().m(function n(i){var r,a,o,l;return A().w(function(n){for(;;)switch(n.p=n.n){case 0:if(!(r=i.target.files[0])){n.n=5;break}return n.p=1,n.n=2,r.text();case 2:a=n.v,o=JSON.parse(a),t.userConfig.lastConfigFile=r.name,t.saveUserConfig(),e({config:o,filePath:r.name}),n.n=4;break;case 3:n.p=3,l=n.v,window.logError("Error parsing config file: "+l.message),e(null);case 4:n.n=6;break;case 5:e(null);case 6:return n.a(2)}},n,null,[[1,3]])}));return function(t){return n.apply(this,arguments)}}(),n.click()})}},{key:"loadConfigFromPath",value:(i=j(A().m(function t(e){var n,i,r,a;return A().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,!q||!q.readFileSync){t.n=1;break}return n=JSON.parse(q.readFileSync(e,"utf8")),t.a(2,n);case 1:if(!W){t.n=4;break}return t.n=2,fetch(e);case 2:if(!(i=t.v).ok){t.n=4;break}return t.n=3,i.json();case 3:return r=t.v,t.a(2,r);case 4:t.n=6;break;case 5:return t.p=5,a=t.v,window.logError("Error auto-loading config: "+a.message),t.a(2,null);case 6:return t.a(2,null)}},t,null,[[0,5]])})),function(t){return i.apply(this,arguments)})},{key:"getAvailableConfigs",value:(n=j(A().m(function t(){var e,n,i;return A().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,e=this.getConfigsPath(),!(q&&q.existsSync&&q.readdirSync)){t.n=2;break}if(q.existsSync(e)){t.n=1;break}return t.a(2,[]);case 1:return n=q.readdirSync(e),t.a(2,n.filter(function(t){return t.endsWith(".json")}).map(function(t){return{name:t,path:U.join(e,t)}}));case 2:if(!W){t.n=3;break}return t.a(2,[{name:"example-synth.json",path:"configs/example-synth.json"},{name:"novation-summit.json",path:"configs/novation-summit.json"}]);case 3:return t.a(2,[]);case 4:return t.p=4,i=t.v,window.logError("Error listing configs: "+i.message),t.a(2,[])}},t,this,[[0,4]])})),function(){return n.apply(this,arguments)})},{key:"validateConfig",value:function(t){if(!t||"object"!==L(t))throw new Error("Invalid configuration format");if(!t.name)throw new Error('Configuration missing required "name" field');if(!t.tabs||!Array.isArray(t.tabs))throw new Error('Configuration missing required "tabs" array');return!0}}],e&&F(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,r}();const G=z;function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function K(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,i,r,a){var u=i&&i.prototype instanceof l?i:l,c=Object.create(u.prototype);return $(c,"_invoke",function(n,i,r){var a,l,u,c=0,s=r||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,l=0,u=t,f.n=n,o}};function m(n,i){for(l=n,u=i,e=0;!d&&c&&!r&&e<s.length;e++){var r,a=s[e],m=f.p,v=a[2];n>3?(r=v===i)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=t):a[0]<=m&&((r=n<2&&m<a[1])?(l=0,f.v=i,f.n=a[1]):m<v&&(r=n<3||a[0]>i||i>v)&&(a[4]=n,a[5]=i,f.n=v,l=0))}if(r||n>1)return o;throw d=!0,i}return function(r,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,v),l=s,u=v;(e=l<2?t:u)||!d;){a||(l?l<3?(l>1&&(f.n=-1),m(l,u)):f.n=u:f.v=u);try{if(c=2,a){if(l||(r="next"),e=a[r]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,l<2&&(l=0)}else 1===l&&(e=a.return)&&e.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=t}else if((e=(d=f.n<0)?u:n.call(i,f))!==o)break}catch(e){a=t,l=1,u=e}finally{c=1}}return{value:e,done:d}}}(n,r,a),!0),c}var o={};function l(){}function u(){}function c(){}e=Object.getPrototypeOf;var s=[][i]?e(e([][i]())):($(e={},i,function(){return this}),e),d=c.prototype=l.prototype=Object.create(s);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,$(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=c,$(d,"constructor",c),$(c,"constructor",u),u.displayName="GeneratorFunction",$(c,r,"GeneratorFunction"),$(d),$(d,r,"Generator"),$(d,i,function(){return this}),$(d,"toString",function(){return"[object Generator]"}),(K=function(){return{w:a,m:f}})()}function $(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}$=function(t,e,n,i){function a(e,n){$(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},$(t,e,n,i)}function Y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,r,a,o,l=[],u=!0,c=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=a.call(n)).done)&&(l.push(i.value),l.length!==e);u=!0);}catch(t){c=!0,r=t}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw r}}return l}}(t,e)||Q(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Q(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw a}}}}function Q(t,e){if(t){if("string"==typeof t)return Z(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(t,e):void 0}}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function tt(t,e,n,i,r,a,o){try{var l=t[a](o),u=l.value}catch(t){return void n(t)}l.done?e(u):Promise.resolve(u).then(i,r)}function et(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var a=t.apply(e,n);function o(t){tt(a,i,r,o,l,"next",t)}function l(t){tt(a,i,r,o,l,"throw",t)}o(void 0)})}}function nt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,it(i.key),i)}}function it(t){var e=function(t){if("object"!=J(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==J(e)?e:e+""}var rt,at,ot,lt="undefined"!=typeof window&&window.require;!function(){if(lt)try{rt=window.require("fs"),at=window.require("path");var t=window.require("electron");ot=t.ipcRenderer}catch(t){window.logWarn("Node integration not available in Electron renderer")}}();const ut=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.configManager=e},e=[{key:"exportPatch",value:(i=et(K().m(function t(){var e,n,i,r,a,o,l,u,c,s,d,f,m,v,p,h,y,g,w,b,E,C,M,S,x,I,k,P;return K().w(function(t){for(;;)switch(t.p=t.n){case 0:if(null!==(e=window.uiManager)&&void 0!==e&&e.currentConfig){t.n=1;break}throw new Error("No synthesizer configuration loaded.");case 1:if(null!==(n=window.synthEditor)&&void 0!==n&&n.sysExHandler){t.n=2;break}throw new Error("SysEx handler not available.");case 2:if(t.p=2,!window.midiManager.inputDevice){t.n=6;break}return t.p=3,t.n=4,window.synthEditor.sysExHandler.getDumpAsBaseline();case 4:u=t.v,t.n=6;break;case 5:t.p=5,k=t.v,window.logWarn("Failed to get baseline from synthesizer for export, using generated dump:",k);case 6:if(u&&0!==u.trim().length){t.n=11;break}if(t.p=7,!((c=window.synthEditor.sysExHandler.generatePatchDump())&&c.length>0)){t.n=8;break}u=c.map(function(t){return t.toString(16).toUpperCase().padStart(2,"0")}).join(" "),window.logInfo("Using generated patch dump for export"),t.n=9;break;case 8:throw new Error("Cannot generate patch dump - no template available");case 9:t.n=11;break;case 10:throw t.p=10,t.v,new Error("Failed to generate patch dump from current values");case 11:if(s=new Map(window.uiManager.controlValues),null!==(i=window.multiModeManager)&&void 0!==i&&i.isInMultiMode()){d=X(window.uiManager.multiValues);try{for(d.s();!(f=d.n()).done;)m=Y(f.value,2),v=m[0],p=m[1],s.set(v,p)}catch(t){d.e(t)}finally{d.f()}}if(h=window.synthEditor.sysExHandler.applyControlValuesToDump(u,s),y=h.trim().split(/\s+/).map(function(t){return parseInt(t,16)}),g="patch",w=null===(r=window.multiModeManager)||void 0===r?void 0:r.isInMultiMode(),b=(null===(a=window.uiManager.multiValues)||void 0===a?void 0:a.get("__multi_name"))||(null===(o=window.uiManager.currentConfig)||void 0===o||null===(o=o.multi)||void 0===o||null===(o=o.multiName)||void 0===o?void 0:o.default),E=window.uiManager.controlValues.get("patchName")||(null===(l=window.uiManager.currentConfig)||void 0===l||null===(l=l.patchName)||void 0===l?void 0:l.default),(C=w?b||E:E||b)&&"string"==typeof C&&(g=C.trim().replace(/[^a-z0-9\s]/gi,"_")),!window.AppConfig.isWeb){t.n=12;break}return M=new Blob([new Uint8Array(y)],{type:"application/octet-stream"}),S=URL.createObjectURL(M),(x=document.createElement("a")).href=S,x.download="".concat(g,".syx"),document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(S),t.a(2,{success:!0,filename:"".concat(g,".syx")});case 12:return t.n=13,ot.invoke("show-save-dialog",{title:"Export Patch",defaultPath:this.configManager.userConfig.lastPatchFolder?at.join(this.configManager.userConfig.lastPatchFolder,"".concat(g,".syx")):"".concat(g,".syx"),filters:[{name:"SysEx Files",extensions:["syx"]}]});case 13:if(!(I=t.v)){t.n=14;break}return rt.writeFileSync(I,Buffer.from(y)),this.configManager.userConfig.lastPatchFolder=at.dirname(I),this.configManager.saveUserConfig(),t.a(2,{success:!0,filename:at.basename(I)});case 14:return t.a(2,{success:!1});case 15:t.n=17;break;case 16:throw t.p=16,P=t.v,new Error("Export failed: ".concat(P.message));case 17:return t.a(2)}},t,this,[[7,10],[3,5],[2,16]])})),function(){return i.apply(this,arguments)})},{key:"importPatch",value:(n=et(K().m(function t(){var e,n,i,r;return K().w(function(t){for(;;)switch(t.n){case 0:if(null!==(e=window.uiManager)&&void 0!==e&&e.currentConfig){t.n=1;break}throw new Error("No synthesizer configuration loaded.");case 1:if(!window.AppConfig.isWeb){t.n=2;break}return t.a(2,new Promise(function(t,e){var n=document.createElement("input");n.type="file",n.accept=".syx",n.onchange=function(n){var i=n.target.files[0];if(i){var r=new FileReader;r.onload=function(n){try{var r=n.target.result,a=Array.from(new Uint8Array(r));t({success:!0,filename:i.name,sysexData:a})}catch(t){e(new Error("Error reading SysEx file: "+t.message))}},r.readAsArrayBuffer(i)}else t({success:!1})},n.click()}));case 2:return t.n=3,ot.invoke("show-open-dialog",{title:"Import Patch",defaultPath:this.configManager.userConfig.lastPatchFolder,filters:[{name:"SysEx Files",extensions:["syx"]}],properties:["openFile"]});case 3:if(n=t.v){t.n=4;break}return t.a(2,{success:!1});case 4:return i=rt.readFileSync(n),r=Array.from(i),this.configManager.userConfig.lastPatchFolder=at.dirname(n),this.configManager.saveUserConfig(),t.a(2,{success:!0,filename:at.basename(n),sysexData:r});case 5:return t.a(2)}},t,this)})),function(){return n.apply(this,arguments)})},{key:"validateSysEx",value:function(t){if(!Array.isArray(t)||t.length<2)throw new Error("Invalid SysEx data format");if(240!==t[0])throw new Error("SysEx must start with F0");if(247!==t[t.length-1])throw new Error("SysEx must end with F7");return!0}}],e&&nt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i}();function ct(t){return ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct(t)}function st(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,dt(i.key),i)}}function dt(t){var e=function(t){if("object"!=ct(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ct(e)?e:e+""}const ft=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"showConfirm",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Yes",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"No",r=document.createElement("div");r.className="dialog-overlay";var a=document.createElement("div");a.className="dialog-content",a.innerHTML='\n            <div style="margin-bottom: 20px; text-align: center;">'.concat(t,'</div>\n            <div style="display: flex; gap: 10px; justify-content: center;">\n                <button id="no-btn" class="btn-secondary">').concat(i,'</button>\n                <button id="yes-btn" class="btn-primary">').concat(n,"</button>\n            </div>\n        "),document.body.appendChild(r),r.appendChild(a);var o=function(t){document.body.removeChild(r),e(t)};a.querySelector("#no-btn").addEventListener("click",function(){return o(!1)}),a.querySelector("#yes-btn").addEventListener("click",function(){return o(!0)}),a.querySelector("#yes-btn").focus()}},{key:"showConfirmPromise",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Yes",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"No";return new Promise(function(r){return e.showConfirm(t,r,n,i)})}},{key:"showTextInput",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=document.createElement("div");i.className="dialog-overlay";var r=document.createElement("div");r.className="dialog-content",r.innerHTML='\n            <h3 style="margin: 0 0 15px 0;">'.concat(t,'</h3>\n            <input id="text-input" type="text" value="').concat(e,'" class="control-input" style="width: 100%; margin-bottom: 15px;">\n            <div style="text-align: right; gap: 10px; display: flex; justify-content: flex-end;">\n                <button id="cancel-btn" class="btn-secondary">Cancel</button>\n                <button id="ok-btn" class="btn-primary">OK</button>\n            </div>\n        '),document.body.appendChild(i),i.appendChild(r);var a=r.querySelector("#text-input");setTimeout(function(){a.focus(),a.select()},10);var o=function(t){document.body.removeChild(i),n(t)};r.querySelector("#cancel-btn").addEventListener("click",function(){return o(null)}),r.querySelector("#ok-btn").addEventListener("click",function(){var t=a.value.trim();o(t||null)}),a.addEventListener("keydown",function(t){"Enter"===t.key&&r.querySelector("#ok-btn").click(),"Escape"===t.key&&r.querySelector("#cancel-btn").click()})}},{key:"showTextInputPromise",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Promise(function(i){return e.showTextInput(t,n,i)})}},{key:"showAlert",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Alert",n=document.createElement("div");n.className="dialog-overlay";var i=document.createElement("div");i.className="dialog-content",i.innerHTML='\n            <h3 style="margin: 0 0 15px 0;">'.concat(e,'</h3>\n            <div style="margin-bottom: 20px;">').concat(t,'</div>\n            <div style="text-align: right;">\n                <button id="ok-btn" class="btn-primary">OK</button>\n            </div>\n        '),document.body.appendChild(n),n.appendChild(i);var r=function(){document.body.removeChild(n)};i.querySelector("#ok-btn").addEventListener("click",r),i.querySelector("#ok-btn").focus();var a=function(t){"Escape"===t.key&&(r(),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a)}}],e&&st(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function mt(t){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mt(t)}function vt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,pt(i.key),i)}}function pt(t){var e=function(t){if("object"!=mt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=mt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==mt(e)?e:e+""}const ht=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},e=[{key:"getContainer",value:function(){return this.container||(this.container=document.getElementById("notification-container")),this.container}},{key:"show",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,i=this.getContainer();if(i){var r=document.createElement("div");r.className="notification ".concat(e),r.textContent=t,r.style.cursor="pointer";var a=function(){i.contains(r)&&(r.classList.remove("show"),setTimeout(function(){i.contains(r)&&i.removeChild(r)},300))};r.addEventListener("click",a),i.appendChild(r),setTimeout(function(){return r.classList.add("show")},10),setTimeout(a,n)}else window.logWarn("Notification container not found")}},{key:"success",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.show(t,"success",e)}},{key:"error",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this.show(t,"error",e)}},{key:"warning",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e3;this.show(t,"warning",e)}},{key:"info",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;this.show(t,"info",e)}},{key:"clear",value:function(){var t=this.getContainer();t&&(t.innerHTML="")}}],e&&vt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function gt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,wt(i.key),i)}}function wt(t){var e=function(t){if("object"!=yt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yt(e)?e:e+""}var bt=function(){return t=function t(e,n,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.uiManager=e,this.midiManager=n,this.configManager=i,this.logger=r,this.isMultiMode=!1,this.currentPart="A",this.singleChannel=1,this.partChannels={},this.multiConfig=null,this.initializeEventListeners(),this.setupHotkeys()},e=[{key:"initializeEventListeners",value:function(){var t=this,e=document.getElementById("single-mode"),n=document.getElementById("multi-mode");e&&n&&(e.addEventListener("click",function(){return t.switchToSingleMode()}),n.addEventListener("click",function(){return t.switchToMultiMode()}));var i=document.getElementById("configure-channels");i&&i.addEventListener("click",function(){return t.openChannelConfigModal()}),this.initializeModalListeners()}},{key:"initializeModalListeners",value:function(){var t=this;["close-channel-config","cancel-channel-config"].forEach(function(e){var n=document.getElementById(e);n&&n.addEventListener("click",function(){return t.closeChannelConfigModal()})});var e=document.getElementById("save-channel-config");e&&e.addEventListener("click",function(){return t.saveChannelConfig()});var n=document.getElementById("single-channel");n&&n.addEventListener("change",function(){return t.updateChannelWarning()})}},{key:"initialize",value:function(t){this.multiConfig=t.multi||null,this.multiConfig&&this.multiConfig.multiParts&&this.initializePartChannels(),this.showModeSelector(),this.setupDynamicChannelModal(),this.loadConfiguration()}},{key:"initializePartChannels",value:function(){var t=this;this.partChannels={},this.multiConfig.multiParts.forEach(function(e,n){t.partChannels[e]=n+2})}},{key:"setupDynamicChannelModal",value:function(){var t=this,e=document.getElementById("multi-channel-config");e.innerHTML="",this.multiConfig.multiParts.forEach(function(n){var i="part-".concat(n.toLowerCase(),"-channel"),r=document.createElement("div");r.className="channel-group";var a=document.createElement("label");a.setAttribute("for",i),a.textContent="Part ".concat(n," Channel:");var o=document.createElement("select");o.id=i,o.className="channel-select";for(var l=1;l<=16;l++){var u=document.createElement("option");u.value=l,u.textContent=l,l===t.partChannels[n]&&(u.selected=!0),o.appendChild(u)}o.addEventListener("change",function(){return t.updateChannelWarning()}),r.appendChild(a),r.appendChild(o),e.appendChild(r)})}},{key:"showModeSelector",value:function(){var t=document.getElementById("mode-selector"),e=document.getElementById("configure-channels");t&&this.multiConfig&&this.multiConfig.multiParts&&(t.style.display="flex"),e&&(e.style.display="block"),this.updateButtonLabels()}},{key:"switchToSingleMode",value:function(){var t,e;this.isMultiMode=!1,null===(t=document.getElementById("single-mode"))||void 0===t||t.classList.add("active"),null===(e=document.getElementById("multi-mode"))||void 0===e||e.classList.remove("active"),this.updateButtonLabels(),this.hidePartSelectorHotbar(),this.updateCurrentMidiChannel(),window.uiManager&&(window.uiManager.switchToPartState(),window.uiManager.updateNamesUI()),this.saveConfiguration()}},{key:"switchToMultiMode",value:function(){var t,e;this.multiConfig&&this.multiConfig.multiParts?(this.isMultiMode=!0,null===(t=document.getElementById("single-mode"))||void 0===t||t.classList.remove("active"),null===(e=document.getElementById("multi-mode"))||void 0===e||e.classList.add("active"),this.updateButtonLabels(),this.showPartSelectorHotbar(),this.updateCurrentMidiChannel(),window.uiManager&&(window.uiManager.switchToPartState(),window.uiManager.updateNamesUI()),this.saveConfiguration()):this.logger.warn("Multi mode not supported for current configuration")}},{key:"updateButtonLabels",value:function(){var t=document.getElementById("get-patch");t&&(t.title=this.isMultiMode?"Get multi from synthesizer":"Get patch from synthesizer");var e=document.getElementById("export-patch");e&&(e.textContent=this.isMultiMode?"Export Multi":"Export Patch");var n=document.getElementById("import-patch");n&&(n.textContent=this.isMultiMode?"Import Multi":"Import Patch")}},{key:"updateCurrentMidiChannel",value:function(){if(this.isMultiMode){var t=this.partChannels[this.currentPart];this.midiManager.setChannel(t)}else this.midiManager.setChannel(this.singleChannel)}},{key:"validateChannelAssignments",value:function(){var t=Object.values(this.partChannels);t.filter(function(e,n){return t.indexOf(e)!==n}).length>0&&window.notificationManager&&window.notificationManager.show("Warning: Multiple parts are using the same MIDI channel","warning")}},{key:"switchToPart",value:function(t){this.isMultiMode&&this.multiConfig.multiParts.includes(t)&&(this.currentPart=t,this.updateCurrentMidiChannel(),this.updatePartSelectorButtons(),window.uiManager&&(window.uiManager.switchToPartState(),window.uiManager.updateNamesUI()))}},{key:"getCurrentMidiChannel",value:function(){return this.isMultiMode?this.partChannels[this.currentPart]:this.singleChannel}},{key:"getPartChannel",value:function(t){return this.partChannels[t]||1}},{key:"isInMultiMode",value:function(){return this.isMultiMode}},{key:"getAvailableParts",value:function(){return this.multiConfig?this.multiConfig.multiParts:[]}},{key:"getMultiConfig",value:function(){return this.multiConfig}},{key:"loadConfiguration",value:function(){var t=this,e=this.configManager.userConfig;if(e.multiMode){e.multiMode.singleChannel&&(this.singleChannel=e.multiMode.singleChannel),e.multiMode.partChannels&&this.multiConfig&&this.multiConfig.multiParts&&this.multiConfig.multiParts.forEach(function(n){void 0!==e.multiMode.partChannels[n]&&(t.partChannels[n]=e.multiMode.partChannels[n])});var n=document.getElementById("single-channel");n&&(n.value=this.singleChannel),this.multiConfig&&this.multiConfig.multiParts&&this.multiConfig.multiParts.forEach(function(e){var n=document.getElementById("part-".concat(e.toLowerCase(),"-channel"));n&&t.partChannels[e]&&(n.value=t.partChannels[e])})}}},{key:"saveConfiguration",value:function(){var t=this,e={};this.multiConfig&&this.multiConfig.multiParts&&this.multiConfig.multiParts.forEach(function(n){void 0!==t.partChannels[n]&&(e[n]=t.partChannels[n])}),this.configManager.userConfig.multiMode={singleChannel:this.singleChannel,partChannels:e},this.configManager.saveUserConfig()}},{key:"openChannelConfigModal",value:function(){var t=this,e=document.getElementById("single-channel");e&&(e.value=this.singleChannel),this.multiConfig&&this.multiConfig.multiParts&&this.multiConfig.multiParts.forEach(function(e){var n="part-".concat(e.toLowerCase(),"-channel"),i=document.getElementById(n);i&&(i.value=t.partChannels[e]||1)}),this.updateChannelWarning();var n=document.getElementById("channel-config-modal");n&&n.classList.remove("hidden")}},{key:"closeChannelConfigModal",value:function(){var t=document.getElementById("channel-config-modal");t&&t.classList.add("hidden")}},{key:"saveChannelConfig",value:function(){var t=this,e=document.getElementById("single-channel");if(e&&(this.singleChannel=parseInt(e.value)),this.multiConfig&&this.multiConfig.multiParts){var n=[];this.multiConfig.multiParts.forEach(function(e){var i="part-".concat(e.toLowerCase(),"-channel"),r=document.getElementById(i);r&&(t.partChannels[e]=parseInt(r.value),n.push("Part ".concat(e,"=").concat(t.partChannels[e])))})}this.updateCurrentMidiChannel(),this.saveConfiguration(),this.closeChannelConfigModal()}},{key:"updateChannelWarning",value:function(){var t=document.getElementById("channel-warning");if(t&&this.multiConfig&&this.multiConfig.multiParts){var e=[];this.multiConfig.multiParts.forEach(function(t){var n=document.getElementById("part-".concat(t.toLowerCase(),"-channel"));n&&e.push(parseInt(n.value))}),e.filter(function(t,n){return e.indexOf(t)!==n}).length>0?(t.style.display="block",t.textContent="Warning: Multiple parts are using the same MIDI channel"):t.style.display="none"}}},{key:"showPartSelectorHotbar",value:function(){var t=this;if(this.multiConfig&&this.multiConfig.multiParts){var e=document.getElementById("part-selector-hotbar"),n=document.getElementById("part-buttons-container");e&&n&&(n.innerHTML="",this.multiConfig.multiParts.forEach(function(e){var i=document.createElement("button");i.className="part-button",i.textContent=e,i.onclick=function(){return t.switchToPart(e)},e===t.currentPart&&i.classList.add("active"),n.appendChild(i)}),e.style.display="block")}}},{key:"hidePartSelectorHotbar",value:function(){var t=document.getElementById("part-selector-hotbar");t&&(t.style.display="none")}},{key:"updatePartSelectorButtons",value:function(){var t=this,e=document.getElementById("part-buttons-container");e&&e.querySelectorAll(".part-button").forEach(function(e){e.textContent===t.currentPart?e.classList.add("active"):e.classList.remove("active")})}},{key:"setupHotkeys",value:function(){var t=this;document.addEventListener("keydown",function(e){if(t.isMultiMode){var n=parseInt(e.key);if(!(isNaN(n)||n<1||n>9)){var i=document.activeElement;if(!i||"INPUT"!==i.tagName&&"TEXTAREA"!==i.tagName){var r=t.getAvailableParts(),a=n-1;if(a<r.length){var o=r[a];t.switchToPart(o),e.preventDefault()}}}}})}}],e&&gt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();const Et=bt;function Ct(t){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct(t)}function Mt(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,i,r,a){var u=i&&i.prototype instanceof l?i:l,c=Object.create(u.prototype);return St(c,"_invoke",function(n,i,r){var a,l,u,c=0,s=r||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,l=0,u=t,f.n=n,o}};function m(n,i){for(l=n,u=i,e=0;!d&&c&&!r&&e<s.length;e++){var r,a=s[e],m=f.p,v=a[2];n>3?(r=v===i)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=t):a[0]<=m&&((r=n<2&&m<a[1])?(l=0,f.v=i,f.n=a[1]):m<v&&(r=n<3||a[0]>i||i>v)&&(a[4]=n,a[5]=i,f.n=v,l=0))}if(r||n>1)return o;throw d=!0,i}return function(r,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,v),l=s,u=v;(e=l<2?t:u)||!d;){a||(l?l<3?(l>1&&(f.n=-1),m(l,u)):f.n=u:f.v=u);try{if(c=2,a){if(l||(r="next"),e=a[r]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,l<2&&(l=0)}else 1===l&&(e=a.return)&&e.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=t}else if((e=(d=f.n<0)?u:n.call(i,f))!==o)break}catch(e){a=t,l=1,u=e}finally{c=1}}return{value:e,done:d}}}(n,r,a),!0),c}var o={};function l(){}function u(){}function c(){}e=Object.getPrototypeOf;var s=[][i]?e(e([][i]())):(St(e={},i,function(){return this}),e),d=c.prototype=l.prototype=Object.create(s);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,St(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=c,St(d,"constructor",c),St(c,"constructor",u),u.displayName="GeneratorFunction",St(c,r,"GeneratorFunction"),St(d),St(d,r,"Generator"),St(d,i,function(){return this}),St(d,"toString",function(){return"[object Generator]"}),(Mt=function(){return{w:a,m:f}})()}function St(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}St=function(t,e,n,i){function a(e,n){St(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},St(t,e,n,i)}function xt(t,e,n,i,r,a,o){try{var l=t[a](o),u=l.value}catch(t){return void n(t)}l.done?e(u):Promise.resolve(u).then(i,r)}function It(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var a=t.apply(e,n);function o(t){xt(a,i,r,o,l,"next",t)}function l(t){xt(a,i,r,o,l,"throw",t)}o(void 0)})}}function kt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Pt(i.key),i)}}function Pt(t){var e=function(t){if("object"!=Ct(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ct(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ct(e)?e:e+""}var Nt;if("undefined"!=typeof window&&window.require)try{Nt=window.require("fs")}catch(t){window.logWarn("Node integration not available")}var Dt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isDialogOpen=!1,this.configManager=new G,this.dialogManager=new ft,this.notificationManager=new ht,this.patchManager=new ut(this.configManager),this.sysExHandler=new V(this),this.multiModeManager=null,"undefined"!=typeof window&&window.require&&this.initialize()},e=[{key:"initialize",value:(d=It(Mt().m(function t(){return Mt().w(function(t){for(;;)switch(t.n){case 0:return this.configureWebUI(),t.n=1,window.midiManager.initialize();case 1:if(this.setupEventListeners(),this.updateMIDIStatus(),this.multiModeManager=new Et(window.uiManager,window.midiManager,this.configManager,window.logger),window.multiModeManager=this.multiModeManager,this.attemptAutoConnect(),!window.AppConfig.autoLoadDefaultConfig){t.n=3;break}return t.n=2,this.loadConfigFromPath(window.AppConfig.defaultConfigPath);case 2:t.n=4;break;case 3:if(!(this.configManager.userConfig.lastConfigFile&&Nt&&Nt.existsSync&&Nt.existsSync(this.configManager.userConfig.lastConfigFile))){t.n=4;break}return t.n=4,this.loadConfigFromPath(this.configManager.userConfig.lastConfigFile);case 4:window.addEventListener("beforeunload",function(){window.midiManager.isConnected&&window.midiManager.disconnect()});case 5:return t.a(2)}},t,this)})),function(){return d.apply(this,arguments)})},{key:"setupEventListeners",value:function(){this.setupMainControlListeners(),this.setupParameterActionListeners(),this.setupMonitorListeners(),this.setupTesterListeners(),this.setupMiscListeners()}},{key:"setupMainControlListeners",value:function(){var t=this;document.getElementById("connect-midi").addEventListener("click",function(){return t.handleMIDIButtonClick()}),document.getElementById("load-config-header").addEventListener("click",function(){return t.loadConfigFile()}),document.getElementById("load-config").addEventListener("click",function(){return t.loadConfigFile()}),document.getElementById("export-patch").addEventListener("click",function(){return t.exportPatch()}),document.getElementById("import-patch").addEventListener("click",function(){return t.importPatch()})}},{key:"setupParameterActionListeners",value:function(){var t=this;document.getElementById("reset-all-defaults").addEventListener("click",function(){window.uiManager&&t.dialogManager.showConfirm("Send init patch to synthesizer? This will reset all parameters to default values.",function(t){t&&window.uiManager.sendInitPatch()})}),document.getElementById("get-patch").addEventListener("click",function(){t.getPatchFromSynth()}),document.getElementById("send-all-parameters").addEventListener("click",function(){window.uiManager&&t.dialogManager.showConfirm("Send all parameters to your synthesizer?",function(t){t&&window.uiManager.sendAllParameters()})})}},{key:"setupMonitorListeners",value:function(){var t=this;document.getElementById("toggle-monitor").addEventListener("click",function(){return t.toggleMIDIMonitor()}),document.getElementById("clear-monitor").addEventListener("click",function(){return t.clearMIDIMonitor()}),document.getElementById("expand-monitor").addEventListener("click",function(){return t.showMIDITesterModal()}),document.getElementById("close-midi-tester").addEventListener("click",function(){return t.closeMIDITesterModal()}),document.getElementById("modal-clear-monitor").addEventListener("click",function(){return t.clearModalMIDIMonitor()})}},{key:"setupTesterListeners",value:function(){var t=this;document.querySelectorAll(".tester-tab").forEach(function(e){e.addEventListener("click",function(){return t.switchTesterTab(e.dataset.tab)})}),this.setupCCTester(),this.setupCCPairTester(),this.setupNRPNTester(),this.setupSysExTester(),this.setupProgramTester()}},{key:"setupMiscListeners",value:function(){var t=this;document.getElementById("help-mode-toggle").addEventListener("click",function(){return t.toggleHelpMode()}),this.setupMenuSystem(),this.setupMIDIStatus(),window.addEventListener("resize",function(){return t.updateMIDIStatus()})}},{key:"configureWebUI",value:function(){var t=[];window.AppConfig.showLoadConfigButton||t.push(document.getElementById("load-config-header"),document.getElementById("load-config-separator"),document.getElementById("load-config"),document.getElementById("dump-mapping-status"),document.getElementById("welcome")),t.forEach(function(t){t&&(t.style.display="none")})}},{key:"showMIDIDeviceDialog",value:(s=It(Mt().m(function t(){var e,n,i,r,a;return Mt().w(function(t){for(;;)switch(t.n){case 0:if(!this.isDialogOpen){t.n=1;break}return t.a(2);case 1:this.isDialogOpen=!0;try{e=this.getAvailableMIDIDevices(),n=this.createMIDIDeviceDialog(),i=n.overlay,r=n.dialog,a=n.elements,this.populateDeviceSelectors(e,a),this.createDialogEventHandlers(r,i,a),document.body.appendChild(i),i.appendChild(r)}catch(t){this.notificationManager.error("Error accessing MIDI devices: "+t.message)}case 2:return t.a(2)}},t,this)})),function(){return s.apply(this,arguments)})},{key:"getAvailableMIDIDevices",value:function(){var t=[],e=[];return window.midiManager.midiAccess&&(t=Array.from(window.midiManager.midiAccess.outputs.values()),e=Array.from(window.midiManager.midiAccess.inputs.values())),{outputs:t,inputs:e}}},{key:"createMIDIDeviceDialog",value:function(){var t=document.createElement("div");t.className="dialog-overlay";var e=document.createElement("div");e.className="dialog-content",e.innerHTML='\n            <h3 style="margin: 0 0 15px 0;">Select MIDI Devices</h3>\n            <h4 style="margin: 10px 0 5px 0;">Output Devices:</h4>\n            <select id="midi-output-select" style="width: 100%; padding: 5px; background: #3a3a3a; color: white; border: 1px solid #4a4a4a;"></select>\n            <div id="input-device-section"></div>\n            <div id="connection-status" style="margin: 10px 0; min-height: 20px;"></div>\n            <div style="text-align: right; margin-top: 15px;">\n                <button id="cancel-midi" style="margin-right: 10px; background: #666; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Cancel</button>\n                <button id="connect-midi-button" style="background: #4a90e2; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Connect</button>\n            </div>\n        ';var n={outputSelect:e.querySelector("#midi-output-select"),inputSection:e.querySelector("#input-device-section"),statusDiv:e.querySelector("#connection-status"),connectButton:e.querySelector("#connect-midi-button"),cancelButton:e.querySelector("#cancel-midi")};return{overlay:t,dialog:e,elements:n}}},{key:"populateDeviceSelectors",value:function(t,e){var n=t.outputs,i=t.inputs,r=e.outputSelect,a=e.inputSection;if(r.innerHTML='<option value="">Select output device...</option>',n.forEach(function(t){var e=document.createElement("option");e.value=t.id,e.textContent=t.name,r.appendChild(e)}),i.length>0){a.innerHTML='\n                <h4 style="margin: 10px 0 5px 0;">Input Device (Optional):</h4>\n                <select id="midi-input-select" style="width: 100%; padding: 5px; background: #3a3a3a; color: white; border: 1px solid #4a4a4a;">\n                    <option value="">No input device</option>\n                </select>\n            ';var o=a.querySelector("#midi-input-select");i.forEach(function(t){var e=document.createElement("option");e.value=t.id,e.textContent=t.name,o.appendChild(e)}),window.midiManager.inputDevice&&(o.value=window.midiManager.inputDevice.id)}window.midiManager.outputDevice&&(r.value=window.midiManager.outputDevice.id)}},{key:"createDialogEventHandlers",value:function(t,e,n){var i=this,r=n.outputSelect,a=n.statusDiv,o=n.connectButton,l=n.cancelButton,u=function(){document.body.removeChild(e),i.isDialogOpen=!1};o.addEventListener("click",It(Mt().m(function e(){return Mt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,i.handleMIDIConnection(r,t,a,u);case 1:return e.a(2)}},e)}))),l.addEventListener("click",u)}},{key:"handleMIDIConnection",value:(c=It(Mt().m(function t(e,n,i,r){var a,o,l,u,c,s,d,f;return Mt().w(function(t){for(;;)switch(t.p=t.n){case 0:if(o=e.value,l=(null===(a=n.querySelector("#midi-input-select"))||void 0===a?void 0:a.value)||null,o){t.n=1;break}return i.textContent="Please select an output device.",i.style.color="#e74c3c",t.a(2);case 1:return t.p=1,i.textContent="Connecting...",i.style.color="#4a90e2",t.n=2,window.midiManager.connectOutput(o);case 2:if(!l){t.n=3;break}return t.n=3,window.midiManager.connectInput(l);case 3:c=window.midiManager.outputDevice,s=window.midiManager.inputDevice,this.configManager.userConfig.lastMidiOutput=c?window.midiManager.createStableDeviceId(c):null,this.configManager.userConfig.lastMidiInput=s?window.midiManager.createStableDeviceId(s):null,this.configManager.saveUserConfig(),this.updateMIDIStatus(),d=(null===(u=window.midiManager.outputDevice)||void 0===u?void 0:u.name)||"MIDI device",this.notificationManager.success("Connected to ".concat(d)),r(),t.n=5;break;case 4:t.p=4,f=t.v,i.textContent="Connection failed: "+f.message,i.style.color="#e74c3c";case 5:return t.a(2)}},t,this,[[1,4]])})),function(t,e,n,i){return c.apply(this,arguments)})},{key:"handleMIDIButtonClick",value:function(){this.showMIDIDeviceDialog()}},{key:"updateMIDIStatus",value:function(){var t=document.getElementById("midi-status");if(window.midiManager.isConnected){var e,n=(null===(e=window.midiManager.outputDevice)||void 0===e?void 0:e.name)||"Unknown Device";t.textContent="MIDI: ".concat(n),t.className="midi-status-text connected"}else t.textContent="MIDI: Disconnected",t.className="midi-status-text disconnected"}},{key:"setupMIDIStatus",value:function(){var t=this;document.getElementById("midi-status").addEventListener("click",function(){window.midiManager.isConnected||t.showMIDIDeviceDialog()})}},{key:"loadConfigFile",value:(u=It(Mt().m(function t(){var e,n;return Mt().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.configManager.loadConfigFile();case 1:if(!(e=t.v)){t.n=2;break}return t.n=2,this.loadSynthConfig(e.config);case 2:t.n=4;break;case 3:t.p=3,n=t.v,this.notificationManager.error(n.message);case 4:return t.a(2)}},t,this,[[0,3]])})),function(){return u.apply(this,arguments)})},{key:"loadConfigFromPath",value:(l=It(Mt().m(function t(e){var n,i;return Mt().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.configManager.loadConfigFromPath(e);case 1:(n=t.v)&&(window.uiManager.loadConfig(n),window.AppConfig.isWeb?(document.title="ArcSynth Editor - ".concat(n.name),document.querySelector("header h1").textContent="ArcSynth Editor - ".concat(n.name)):document.title="ArcSynth Editor - ".concat(n.name),this.sysExHandler.checkDumpMappingAvailability()),t.n=3;break;case 2:t.p=2,i=t.v,window.logError("Error auto-loading config:",i);case 3:return t.a(2)}},t,this,[[0,2]])})),function(t){return l.apply(this,arguments)})},{key:"loadSynthConfig",value:(o=It(Mt().m(function t(e){return Mt().w(function(t){for(;;)switch(t.n){case 0:if(!(this.sysExHandler.baselineSysEx||Object.keys(this.sysExHandler.mappingResults).length>0)){t.n=2;break}return t.n=1,this.dialogManager.showConfirmPromise("Loading a new config will reset the SysEx mapping session. Continue?");case 1:if(t.v){t.n=2;break}return t.a(2);case 2:window.uiManager.loadConfig(e),window.AppConfig.isWeb?(document.title="ArcSynth Editor - ".concat(e.name),document.querySelector("header h1").textContent="ArcSynth Editor - ".concat(e.name)):document.title="ArcSynth Editor - ".concat(e.name),this.sysExHandler.checkDumpMappingAvailability();case 3:return t.a(2)}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"toggleMIDIMonitor",value:function(){var t=document.getElementById("midi-monitor-content"),e=document.getElementById("toggle-monitor");t.classList.toggle("hidden"),e.textContent=t.classList.contains("hidden")?"Show":"Hide",t.classList.contains("hidden")||(t.scrollTop=t.scrollHeight)}},{key:"clearMIDIMonitor",value:function(){var t=document.getElementById("midi-log");t&&(t.innerHTML="")}},{key:"attemptAutoConnect",value:function(){var t=this.configManager.userConfig,e=t.lastMidiOutput,n=t.lastMidiInput;if(e&&window.midiManager.midiAccess){var i=window.midiManager.findDeviceByStableId(e,"output");i&&(window.midiManager.connectOutput(i.id),this.updateMIDIStatus(),this.configManager.saveUserConfig())}if(n&&window.midiManager.midiAccess){var r=window.midiManager.findDeviceByStableId(n,"input");r&&window.midiManager.connectInput(r.id)}}},{key:"exportPatch",value:(a=It(Mt().m(function t(){var e,n;return Mt().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.patchManager.exportPatch();case 1:(e=t.v).success&&this.notificationManager.success('SysEx file "'.concat(e.filename,'" exported!')),t.n=3;break;case 2:t.p=2,n=t.v,this.notificationManager.error(n.message);case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return a.apply(this,arguments)})},{key:"importPatch",value:(r=It(Mt().m(function t(){var e,n,i;return Mt().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.patchManager.importPatch();case 1:if(!(e=t.v).success||!e.sysexData){t.n=4;break}return this.validateSysExData(e.sysexData),this.processSysExImport(e.sysexData),t.n=2,this.showSendConfirmationDialog(e.filename);case 2:return n=t.v,this.applySysExToUI(),t.n=3,this.handleSysExSending(n,e.sysexData,e.filename);case 3:t.n=5;break;case 4:e.success&&this.notificationManager.success('SysEx file "'.concat(e.filename,'" imported!'));case 5:t.n=7;break;case 6:t.p=6,i=t.v,this.notificationManager.error(i.message);case 7:return t.a(2)}},t,this,[[0,6]])})),function(){return r.apply(this,arguments)})},{key:"validateSysExData",value:function(t){if(t.length<2||240!==t[0]||247!==t[t.length-1])throw new Error("Invalid SysEx file format")}},{key:"processSysExImport",value:function(t){var e,n,i=t.map(function(t){return t.toString(16).toUpperCase().padStart(2,"0")}).join(" "),r=(null===(e=window.multiModeManager)||void 0===e?void 0:e.isInMultiMode())&&(null===(n=window.uiManager.currentConfig.multi)||void 0===n?void 0:n.multiDumpRequest),a=window.synthEditor.sysExHandler;if(a.processDumpData(i,r),!a.convertedParameters||0===Object.keys(a.convertedParameters).length)throw new Error("No parameters found in SysEx file");return a.convertedParameters}},{key:"applySysExToUI",value:function(){var t,e=null===(t=window.multiModeManager)||void 0===t?void 0:t.isInMultiMode(),n=window.synthEditor.sysExHandler;e?n.applyConvertedValuesToAllParts():n.applyConvertedValuesToUI()}},{key:"handleSysExSending",value:(i=It(Mt().m(function t(e,n,i){return Mt().w(function(t){for(;;)switch(t.n){case 0:e?window.midiManager.isConnected?window.midiManager.sendSysEx(n)?this.notificationManager.success('SysEx file "'.concat(i,'" imported and sent to synthesizer!')):this.notificationManager.warning('SysEx file "'.concat(i,'" imported but failed to send to synthesizer.')):this.notificationManager.warning('SysEx file "'.concat(i,'" imported but no MIDI device connected.')):this.notificationManager.success('SysEx file "'.concat(i,'" imported!'));case 1:return t.a(2)}},t,this)})),function(t,e,n){return i.apply(this,arguments)})},{key:"showSendConfirmationDialog",value:function(t){return new Promise(function(e){var n,i,r=document.createElement("div");r.className="modal compact-modal",r.innerHTML='\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h2>Import '.concat(null!==(n=window.multiModeManager)&&void 0!==n&&n.isInMultiMode()?"Multi":"Patch",'</h2>\n                        <button id="close-import-modal" class="close-modal">&times;</button>\n                    </div>\n                    <div class="modal-body">\n                        <p>Successfully loaded from <strong>').concat(t,"</strong>.</p>\n                        <p>Would you like to send this ").concat(null!==(i=window.multiModeManager)&&void 0!==i&&i.isInMultiMode()?"multi":"patch",' to the synthesizer now?</p>\n                        <div class="channel-config-actions">\n                            <button id="import-load-only" class="btn-secondary">Load to Editor Only</button>\n                            <button id="import-send-to-synth" class="btn-success">Send to Synth</button>\n                        </div>\n                    </div>\n                </div>\n            '),document.body.appendChild(r);var a=document.getElementById("import-send-to-synth"),o=document.getElementById("import-load-only"),l=document.getElementById("close-import-modal"),u=function(){document.body.removeChild(r)};a.onclick=function(){u(),e(!0)},o.onclick=function(){u(),e(!1)},l.onclick=function(){u(),e(!1)}})}},{key:"showMIDITesterModal",value:function(){document.getElementById("midi-tester-modal").classList.remove("hidden"),this.syncMIDILogToModal()}},{key:"closeMIDITesterModal",value:function(){document.getElementById("midi-tester-modal").classList.add("hidden")}},{key:"switchTesterTab",value:function(t){document.querySelectorAll(".tester-tab").forEach(function(e){return e.classList.toggle("active",e.dataset.tab===t)}),document.querySelectorAll(".tester-content").forEach(function(e){return e.classList.toggle("active",e.id==="".concat(t,"-tester"))})}},{key:"setupCCTester",value:function(){var t=this,e=document.getElementById("cc-value"),n=document.getElementById("cc-value-slider");e.addEventListener("input",function(){return n.value=e.value}),n.addEventListener("input",function(){return e.value=n.value}),document.getElementById("send-cc").addEventListener("click",function(){if(!window.midiManager.isConnected)return t.notificationManager.warning("Not connected.");var n=parseInt(document.getElementById("cc-channel").value),i=window.midiManager.currentChannel;window.midiManager.currentChannel=n,window.midiManager.sendCC(parseInt(document.getElementById("cc-number").value),parseInt(e.value)),window.midiManager.currentChannel=i})}},{key:"setupCCPairTester",value:function(){var t=this,e=document.getElementById("cc-pair-value"),n=document.getElementById("cc-pair-value-slider");e.addEventListener("input",function(){return n.value=e.value}),n.addEventListener("input",function(){return e.value=n.value}),document.getElementById("send-cc-pair").addEventListener("click",function(){if(!window.midiManager.isConnected)return t.notificationManager.warning("Not connected.");var n=parseInt(document.getElementById("cc-pair-channel").value),i=window.midiManager.currentChannel;window.midiManager.currentChannel=n,window.midiManager.sendCCPair(parseInt(document.getElementById("cc-pair-msb").value),parseInt(document.getElementById("cc-pair-lsb").value),parseInt(e.value)),window.midiManager.currentChannel=i})}},{key:"setupNRPNTester",value:function(){var t=this,e=document.getElementById("nrpn-value-msb"),n=document.getElementById("nrpn-value-msb-slider"),i=document.getElementById("nrpn-value-lsb"),r=document.getElementById("nrpn-value-lsb-slider");e.addEventListener("input",function(){return n.value=e.value}),n.addEventListener("input",function(){return e.value=n.value}),i.addEventListener("input",function(){return r.value=i.value}),r.addEventListener("input",function(){return i.value=r.value}),document.getElementById("send-nrpn").addEventListener("click",function(){if(!window.midiManager.isConnected)return t.notificationManager.warning("Not connected.");var n=parseInt(document.getElementById("nrpn-channel").value),r=window.midiManager.currentChannel;window.midiManager.currentChannel=n,window.midiManager.sendNRPN(parseInt(document.getElementById("nrpn-msb").value),parseInt(document.getElementById("nrpn-lsb").value),parseInt(e.value),parseInt(i.value),document.getElementById("nrpn-exclude-lsb").checked),window.midiManager.currentChannel=r})}},{key:"setupSysExTester",value:function(){var t=this;document.getElementById("send-sysex").addEventListener("click",function(){if(!window.midiManager.isConnected)return t.notificationManager.warning("Not connected.");var e=document.getElementById("sysex-data").value.trim();if(!e)return t.notificationManager.warning("SysEx data required.");var n=e.split(/\s+/).map(function(t){return t.toUpperCase()});if("F0"!==n[0]&&n.unshift("F0"),"F7"!==n[n.length-1]&&n.push("F7"),n.some(function(t){return!/^[0-9A-F]{1,2}$/.test(t)}))return t.notificationManager.error("Invalid hex byte found.");window.midiManager.sendSysEx(n.join(" "))})}},{key:"setupProgramTester",value:function(){var t=this,e=document.getElementById("program-number"),n=document.getElementById("program-number-slider");e.addEventListener("input",function(){return n.value=e.value}),n.addEventListener("input",function(){return e.value=n.value});var i=function(n){if(!window.midiManager.isConnected)return t.notificationManager.warning("Not connected.");var i=parseInt(document.getElementById("program-channel").value),r=window.midiManager.currentChannel;window.midiManager.currentChannel=i;var a=parseInt(e.value),o=parseInt(document.getElementById("bank-msb").value),l=parseInt(document.getElementById("bank-lsb").value);"all"!==n&&"bank"!==n||(document.getElementById("send-bank-msb").checked&&window.midiManager.sendCC(0,o),document.getElementById("send-bank-lsb").checked&&window.midiManager.sendCC(32,l)),"all"!==n&&"program"!==n||window.midiManager.sendProgramChange(a),window.midiManager.currentChannel=r};document.getElementById("send-program-only").addEventListener("click",function(){return i("program")}),document.getElementById("send-bank-only").addEventListener("click",function(){return i("bank")}),document.getElementById("send-program-change").addEventListener("click",function(){return i("all")})}},{key:"syncMIDILogToModal",value:function(){var t=document.getElementById("midi-log"),e=document.getElementById("modal-midi-log");t&&e&&(e.innerHTML=t.innerHTML,e.scrollTop=e.scrollHeight)}},{key:"clearModalMIDIMonitor",value:function(){var t=document.getElementById("modal-midi-log");t&&(t.innerHTML="")}},{key:"getPatchFromSynth",value:(n=It(Mt().m(function t(){var e;return Mt().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.sysExHandler.getDumpFromSynth();case 1:t.n=3;break;case 2:t.p=2,e=t.v,this.notificationManager.error("Error getting patch from synth: "+e.message);case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return n.apply(this,arguments)})},{key:"setupMenuSystem",value:function(){var t=document.getElementById("menu-button"),e=document.getElementById("menu-dropdown");t.addEventListener("click",function(t){t.stopPropagation(),e.classList.toggle("hidden")}),document.addEventListener("click",function(n){t.contains(n.target)||e.contains(n.target)||e.classList.add("hidden")}),e.addEventListener("click",function(){e.classList.add("hidden")})}},{key:"toggleHelpMode",value:function(){window.uiManager&&window.uiManager.toggleHelpMode()}}],e&&kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n,i,r,a,o,l,u,c,s,d}();function Tt(){var t,e,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function a(n,i,r,a){var u=i&&i.prototype instanceof l?i:l,c=Object.create(u.prototype);return Vt(c,"_invoke",function(n,i,r){var a,l,u,c=0,s=r||[],d=!1,f={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,n){return a=e,l=0,u=t,f.n=n,o}};function m(n,i){for(l=n,u=i,e=0;!d&&c&&!r&&e<s.length;e++){var r,a=s[e],m=f.p,v=a[2];n>3?(r=v===i)&&(u=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=t):a[0]<=m&&((r=n<2&&m<a[1])?(l=0,f.v=i,f.n=a[1]):m<v&&(r=n<3||a[0]>i||i>v)&&(a[4]=n,a[5]=i,f.n=v,l=0))}if(r||n>1)return o;throw d=!0,i}return function(r,s,v){if(c>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,v),l=s,u=v;(e=l<2?t:u)||!d;){a||(l?l<3?(l>1&&(f.n=-1),m(l,u)):f.n=u:f.v=u);try{if(c=2,a){if(l||(r="next"),e=a[r]){if(!(e=e.call(a,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,l<2&&(l=0)}else 1===l&&(e=a.return)&&e.call(a),l<2&&(u=TypeError("The iterator does not provide a '"+r+"' method"),l=1);a=t}else if((e=(d=f.n<0)?u:n.call(i,f))!==o)break}catch(e){a=t,l=1,u=e}finally{c=1}}return{value:e,done:d}}}(n,r,a),!0),c}var o={};function l(){}function u(){}function c(){}e=Object.getPrototypeOf;var s=[][i]?e(e([][i]())):(Vt(e={},i,function(){return this}),e),d=c.prototype=l.prototype=Object.create(s);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,Vt(t,r,"GeneratorFunction")),t.prototype=Object.create(d),t}return u.prototype=c,Vt(d,"constructor",c),Vt(c,"constructor",u),u.displayName="GeneratorFunction",Vt(c,r,"GeneratorFunction"),Vt(d),Vt(d,r,"Generator"),Vt(d,i,function(){return this}),Vt(d,"toString",function(){return"[object Generator]"}),(Tt=function(){return{w:a,m:f}})()}function Vt(t,e,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}Vt=function(t,e,n,i){function a(e,n){Vt(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!i,configurable:!i,writable:!i}):t[e]=n:(a("next",0),a("throw",1),a("return",2))},Vt(t,e,n,i)}function Lt(t,e,n,i,r,a,o){try{var l=t[a](o),u=l.value}catch(t){return void n(t)}l.done?e(u):Promise.resolve(u).then(i,r)}function At(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var a=t.apply(e,n);function o(t){Lt(a,i,r,o,l,"next",t)}function l(t){Lt(a,i,r,o,l,"throw",t)}o(void 0)})}}"undefined"!=typeof window&&window.require&&(window.synthEditor=new Dt),window.AppConfig=e,window.logger=y,window.logError=function(t){return y.error(t)},window.logWarn=function(t){return y.warn(t)},window.logInfo=function(t){return y.info(t)},window.logDebug=function(t){return y.debug(t)};var Ot=function(){var t=new URLSearchParams(window.location.search).get("config");if(!t){var e=new URL(window.location);return e.searchParams.set("config","novation-summit"),window.history.replaceState({},"",e),"configs/novation-summit.json"}var n={"novation-summit":"configs/novation-summit.json","example-synth":"configs/example-synth.json"};if(n[t])return n[t];var i=new URL(window.location);return i.searchParams.set("config","novation-summit"),window.history.replaceState({},"",i),"configs/novation-summit.json"}();window.AppConfig.defaultConfigPath=Ot;var Bt=new URLSearchParams(window.location.search).get("config");if(Bt){var jt={"novation-summit":"Novation Summit","example-synth":"Example Synth"}[Bt]||Bt;document.title="ArcSynth Editor - ".concat(jt)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",At(Tt().m(function t(){return Tt().w(function(t){for(;;)switch(t.n){case 0:return window.synthEditor=new Dt,t.n=1,window.synthEditor.initialize();case 1:return t.a(2)}},t)}))):(window.synthEditor=new Dt,window.synthEditor.initialize())})()})();